---
title: "EXTERNAL_REVIEW_PROMPT"
description: "This is a Next.js application (`dormway-lockedin`) with a comprehensive theme system that supports 4 modes: `system`, `light`, `dark`, and `glass`. The landi..."
---

# External Review: Theme System & Landing Page Issues

## Context

This is a Next.js application (`dormway-lockedin`) with a comprehensive theme system that supports 4 modes: `system`, `light`, `dark`, and `glass`. The landing page (`src/app/page.tsx`) has been experiencing significant issues with:

1. **Theme System Usage**: The AI assistant has been struggling to properly use theme tokens instead of hardcoded colors
2. **Landing Page Styling**: Text colors, spacing, design hierarchy, and visual consistency issues across all theme modes
3. **Aurora Background Component**: WebGL-based animated background that needs proper integration with the theme system

## Problem Summary

The assistant has been:
- Hardcoding colors instead of using theme tokens
- Not understanding which theme tokens to use for specific contexts
- Struggling with text readability on the Aurora background
- Missing proper theme-aware styling patterns
- Not following the established theme system architecture

## Critical Files to Review

### Core Theme System Files
1. **`src/lib/theme-config.ts`** (817 lines)
   - Central theme definitions
   - Design system tokens (`--ds-*`)
   - Theme configurations for light/dark/glass modes
   - Hero-specific tokens (`--ds-hero-cta-fg`, `--ds-hero-background`, etc.)

2. **`src/contexts/ThemeContext.tsx`** (~346 lines)
   - React theme provider
   - Theme state management
   - `useTheme()` hook that provides `theme`, `resolvedTheme`, etc.
   - Theme application logic

3. **`src/lib/theme-utils.ts`**
   - Theme utility functions
   - Storage management
   - Theme preference persistence

4. **`src/app/layout.tsx`**
   - SSR hydration script for themes
   - Theme initialization
   - Theme class application to DOM

5. **`tailwind.config.ts`** (if exists)
   - Tailwind configuration
   - `darkMode: 'class'` setup
   - Theme token integration

### Landing Page Files
6. **`src/app/page.tsx`** (2767 lines)
   - Main landing page component
   - Hero section with Aurora background
   - All content sections
   - Current issues:
     - Text colors not using theme tokens correctly
     - Spacing and hierarchy problems
     - Inconsistent styling across theme modes

7. **`src/components/Aurora.tsx`** (348 lines)
   - WebGL-based animated background
   - Theme-aware color stops
   - WebGL context handling
   - CSS fallback implementation

8. **`src/components/NavBar.tsx`** (1043 lines)
   - Navigation bar component
   - Theme-aware styling
   - Landing page specific styling

### Supporting Files
9. **`src/app/globals.css`**
   - Global styles
   - CSS variable definitions
   - Theme-related styles

10. **`src/lib/context-colors.ts`** (if exists)
    - Theme-aware context color mappings
    - Context icon color utilities

11. **`src/utils/contextIcons.ts`**
    - Context icon definitions
    - Theme-aware color integration

## Current Issues

### 1. Theme Token Usage
**Problem**: The assistant has been hardcoding colors like `#ffffff`, `#f8fafc`, etc., instead of using theme tokens.

**What Should Happen**:
- Use `text-[var(--ds-text-primary)]` for primary text
- Use `text-[var(--ds-hero-cta-fg)]` for hero text on Aurora background (white in all themes)
- Use theme tokens consistently throughout

**Current State**: The landing page hero headline is using `text-[var(--ds-hero-cta-fg)]` but other text elements may not be using theme tokens correctly.

### 2. Landing Page Text Readability
**Problem**: Text on the Aurora background is not readable in all theme modes.

**Specific Issues**:
- Main headline ("Never wonder what's due.") needs to be white/light on Aurora
- Problem statement and subheadlines need proper contrast
- Text shadows may not be sufficient for readability

**Expected Behavior**:
- Light mode: Text should be dark or have strong white shadows on Aurora
- Dark/Glass mode: Text should be light/white on Aurora
- All text should use theme tokens, not hardcoded colors

### 3. Spacing & Design Hierarchy
**Problem**: The landing page has spacing and visual hierarchy issues.

**Areas Needing Review**:
- Hero section spacing
- Section spacing and padding
- Text size relationships
- Visual grouping of elements
- Card/surface styling consistency

### 4. Aurora Component Integration
**Problem**: Aurora background may not be properly integrated with theme system.

**Questions to Answer**:
- Are color stops theme-aware?
- Is the blending correct for all themes?
- Does the CSS fallback work properly?
- Are WebGL context issues handled?

## Theme System Architecture

### Available Theme Tokens

**Text Colors**:
- `--ds-text-primary` - Primary text (dark in light mode, light in dark/glass)
- `--ds-text-secondary` - Secondary text
- `--ds-text-muted` - Muted text
- `--ds-hero-cta-fg` - Hero text color (white in all themes)

**Backgrounds**:
- `--ds-surface-0`, `--ds-surface-1`, `--ds-surface-2` - Surface layers
- `--ds-bg-primary`, `--ds-bg-secondary` - Background colors
- `--ds-hero-background` - Hero section background

**Borders**:
- `--ds-border-1`, `--ds-border-2`, `--ds-border-3` - Border hierarchy
- `--ds-border-subtle`, `--ds-border-muted`, `--ds-border-strong` - Semantic borders

**Status Colors**:
- `--ds-status-success`, `--ds-status-warning`, `--ds-status-error`, `--ds-status-info`
- `--ds-status-*-soft` variants

**Brand Colors**:
- `--ds-primary-brand` - Primary brand color
- `--ds-primary-soft` - Soft brand color

### Theme Modes

1. **Light Mode**: Light backgrounds, dark text
2. **Dark Mode**: Dark backgrounds, light text
3. **Glass Mode**: Glassmorphic dark mode with enhanced transparency
4. **System Mode**: Follows OS preference

### Usage Patterns

**Correct Pattern**:
```tsx
// Using CSS variables in className
className="text-[var(--ds-text-primary)] bg-[var(--ds-surface-1)]"

// Using CSS variables in style
style={{ color: 'var(--ds-text-primary)' }}

// Theme-aware conditional (when needed)
className={resolvedTheme === 'light' ? 'text-[var(--ds-text-primary)]' : 'text-[var(--ds-hero-cta-fg)]'}
```

**Wrong Pattern**:
```tsx
// Hardcoded colors
className="text-white" // ❌
style={{ color: '#ffffff' }} // ❌
className="text-[#f8fafc]" // ❌
```

## What Needs to Be Done

### 1. Comprehensive Theme Audit
- Review ALL files listed above
- Identify every instance of hardcoded colors
- Identify every instance of incorrect theme token usage
- Map out the correct theme tokens for each use case

### 2. Landing Page Fixes
- Fix all text colors to use proper theme tokens
- Ensure readability on Aurora background in all themes
- Fix spacing and hierarchy issues
- Ensure visual consistency across all theme modes

### 3. Theme Token Strategy
- Determine which tokens should be used for:
  - Hero headline text on Aurora
  - Problem statement text on Aurora
  - Subheadlines on Aurora
  - Section headings
  - Body text
  - Navigation elements
  - Buttons and CTAs

### 4. Implementation Plan
- Create a prioritized list of fixes
- Provide specific code changes for each issue
- Ensure no regressions in other theme modes
- Test all changes in light/dark/glass modes

## Questions to Answer

1. **Which theme tokens should be used for text on the Aurora background?**
   - Should hero text use `--ds-hero-cta-fg` or a different token?
   - How should text shadows be handled for readability?

2. **What's the correct pattern for theme-aware text colors?**
   - When should we use conditional classes vs. a single token?
   - How do we handle text that needs to be light in all modes?

3. **Are there missing theme tokens?**
   - Do we need new tokens for hero text specifically?
   - Should we add tokens for Aurora-overlay text?

4. **What's the spacing/hierarchy strategy?**
   - What are the correct spacing values?
   - How should sections be structured?
   - What's the proper visual hierarchy?

5. **How should the Aurora component integrate with themes?**
   - Are color stops correct for each theme?
   - Is blending working properly?
   - Are there any WebGL-specific issues?

## Deliverables Needed

1. **Complete Analysis Document**
   - All issues identified
   - Root causes explained
   - Impact assessment

2. **Theme Token Mapping**
   - Which tokens to use where
   - When to use conditionals
   - Best practices guide

3. **Specific Code Fixes**
   - Exact changes needed for `page.tsx`
   - Exact changes needed for `Aurora.tsx`
   - Exact changes needed for `NavBar.tsx`
   - Any other files needing fixes

4. **Implementation Priority**
   - Critical fixes first
   - High-impact fixes next
   - Polish items last

5. **Testing Checklist**
   - What to test in each theme mode
   - Visual regression points
   - Accessibility checks

## Additional Context

- The application uses Next.js 15+ with App Router
- React 18+ with TypeScript
- Tailwind CSS with `darkMode: 'class'`
- CSS Custom Properties for theming
- The theme system architecture is solid - the issue is usage, not architecture
- There are 223+ instances of hardcoded colors across the codebase (per previous audit)
- The landing page is the highest priority for fixes

## Files to Export for Review

Please ensure you have access to:
1. `src/lib/theme-config.ts` (full file)
2. `src/contexts/ThemeContext.tsx` (full file)
3. `src/app/page.tsx` (full file - 2767 lines)
4. `src/components/Aurora.tsx` (full file)
5. `src/components/NavBar.tsx` (full file)
6. `src/app/layout.tsx` (theme-related sections)
7. `src/lib/theme-utils.ts` (if exists)
8. `src/app/globals.css` (theme-related sections)
9. `tailwind.config.ts` (if exists)

## Success Criteria

After fixes:
- ✅ All text uses theme tokens, no hardcoded colors
- ✅ Text is readable on Aurora in all theme modes
- ✅ Spacing and hierarchy are correct
- ✅ Visual consistency across light/dark/glass modes
- ✅ No regressions in other parts of the app
- ✅ WCAG AA contrast compliance
- ✅ Smooth theme switching with no flashes

---

## File Exports

Below are the complete file contents for all critical files. Please analyze these thoroughly.

### File 1: `src/lib/theme-config.ts` (817 lines)

**FULL FILE CONTENT:**

[The complete file content is provided below. This file defines all theme tokens and configurations for light, dark, and glass modes. Key tokens include `--ds-hero-cta-fg` (white in all themes), `--ds-text-primary` (varies by theme), and all surface, border, shadow, and status color tokens.]

**Key Points:**
- Defines `UNIFIED_THEME_TOKENS` for dark, glass, and light modes
- `--ds-hero-cta-fg` is `#ffffff` in ALL themes (light, dark, glass) - line 227, 357, 487
- `--ds-text-primary` varies by theme:
  - Light: `#111827` (dark) - line 723
  - Dark: `#f8fafc` (light) - line 572
  - Glass: `#f9fbff` (light) - line 646
- Hero-specific tokens available: `--ds-hero-cta-fg`, `--ds-hero-background`, `--ds-hero-overlay`, etc.

### File 2: `src/contexts/ThemeContext.tsx` (346 lines)

**FULL FILE CONTENT:**

[The complete file content is provided below. This file contains the React theme provider, `useTheme()` hook, and `applyTheme()` function that applies theme classes and CSS variables to the DOM.]

**Key Points:**
- Provides `useTheme()` hook with `theme`, `resolvedTheme`, `fontSize`, etc. (line 327)
- `resolvedTheme` is `'light' | 'dark' | 'glass'` (system resolved to actual theme) - line 36
- `applyTheme()` function applies theme classes and CSS variables to DOM (line 51)
- Theme classes: `['dark']` for dark, `['dark', 'glass']` for glass, `['light']` for light

### File 3: `src/components/Aurora.tsx` (348 lines)

**FULL FILE CONTENT:**

[The complete file content is provided below. This file contains the WebGL-based Aurora component with shader code, WebGL context handling, and CSS fallback implementation.]

**Key Points:**
- WebGL-based animated background
- Accepts `colorStops`, `amplitude`, `blend`, `speed`, `theme` props (line 119-125)
- Has CSS fallback when WebGL unavailable (line 283-340)
- Uses `gl.clearColor(0, 0, 0, 0)` for transparent background (line 195)
- Uses `gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)` for blending (line 198)
- Shader outputs `vec4(auroraColor, auroraAlpha)` for proper transparency (line 115)

### File 4: `src/components/NavBar.tsx` (1043 lines)

**FULL FILE CONTENT:**

[The complete file content is provided below. This file contains the navigation bar component with theme-aware styling, landing page specific styling, and theme dropdown functionality.]

**Key Points:**
- Uses `useTheme()` to get `resolvedTheme` (line 70)
- Has landing page specific styling with `isLandingPage` check (line 238)
- Uses theme tokens like `text-[var(--ds-text-primary)]` throughout
- Has conditional styling based on `resolvedTheme === 'light'` (lines 241-243, 302-305, etc.)
- Theme dropdown width is `w-36` (line 428, 644)

### File 5: `src/app/page.tsx` (2767 lines) - Critical Sections

**Hero Section (lines 1215-1298):**
```typescript
{/* Problem statement - Hook */}
<p className="text-base sm:text-lg md:text-xl text-[var(--ds-text-primary)] font-semibold [text-shadow:0_1px_3px_rgba(0,0,0,0.25),0_2px_6px_rgba(0,0,0,0.2),0_0_10px_rgba(255,255,255,0.5)] dark:[text-shadow:0_1px_2px_rgba(0,0,0,0.3),0_2px_4px_rgba(0,0,0,0.2),0_0_8px_rgba(255,255,255,0.2)]">
  Ever realize at 11pm something's due tomorrow?
</p>

{/* Main Headline - Two lines, prominent but balanced */}
<h1 className="text-[36px] sm:text-[44px] md:text-[52px] lg:text-[60px] xl:text-[64px] font-black tracking-tight leading-[1.1] font-brand relative text-[var(--ds-hero-cta-fg)]">
  <span className="block [text-shadow:0_2px_12px_rgba(0,0,0,0.3),0_4px_20px_rgba(0,0,0,0.2)] dark:[text-shadow:0_2px_12px_rgba(0,0,0,0.5),0_4px_20px_rgba(0,0,0,0.4)]">
    Never wonder<br />
    what's due.
  </span>
</h1>

{/* Subheadline - Clear process */}
<p className="text-lg sm:text-xl md:text-2xl text-[var(--ds-text-primary)] font-semibold leading-relaxed [text-shadow:0_1px_3px_rgba(0,0,0,0.3),0_2px_6px_rgba(0,0,0,0.25),0_0_12px_rgba(255,255,255,0.6)] dark:[text-shadow:0_1px_3px_rgba(0,0,0,0.4),0_2px_6px_rgba(0,0,0,0.3),0_0_12px_rgba(255,255,255,0.25)]">
  Upload syllabi. Connect Canvas.<br />
  See everything in one place.
</p>
```

**Aurora Rendering (lines 1148-1159):**
```typescript
<div className="pointer-events-none fixed inset-0 -z-10 hidden lg:block">
  {resolvedTheme === 'dark' ? (
    <Aurora colorStops={['#6b21ff', '#ff5fa1', '#ff7b3f']} amplitude={1.0} blend={0.7} speed={0.3} theme={resolvedTheme} />
  ) : resolvedTheme === 'glass' ? (
    <Aurora colorStops={['#6b21ff', '#ff5fa1', '#ff7b3f']} amplitude={1.0} blend={0.7} speed={0.3} theme={resolvedTheme} />
  ) : (
    <Aurora colorStops={['#6b21ff', '#ff5fa1', '#ff7b3f']} amplitude={1.0} blend={0.7} speed={0.3} theme={resolvedTheme} />
  )}
</div>
```

**Root Container (line 1148):**
```typescript
<div className="relative min-h-screen overflow-x-hidden text-[var(--ds-text-primary)]">
```

**Issues Identified:**
1. Problem statement uses `text-[var(--ds-text-primary)]` which is dark in light mode - may not be readable on Aurora
2. Subheadline uses `text-[var(--ds-text-primary)]` which is dark in light mode - may not be readable on Aurora
3. Main headline uses `text-[var(--ds-hero-cta-fg)]` which is correct (white in all themes)
4. All three Aurora instances use the same color stops - should they be different per theme?
5. Root div has `text-[var(--ds-text-primary)]` which may be overriding child text colors

### File 6: `src/app/layout.tsx` - Theme Hydration Script (lines 48-692)

The theme hydration script is embedded in the layout file. Key sections:
- Theme initialization on page load
- Storage sanitization
- Theme class application
- CSS variable injection

### File 7: `src/app/globals.css` - Theme-Related Sections

```css
:root {
  /* Theme Variables (Set by ThemeContext) */
  --theme-accent: var(--dormway-gradient);
  --theme-accent-primary: var(--dormway-purple);
  --theme-accent-secondary: var(--dormway-pink);
  --theme-font-size: 1rem;

  /* Unified token fallbacks */
  --ds-surface-0: #f5f7ff;
  --ds-surface-1: #ffffff;
  --ds-surface-2: #f8fafc;
  --ds-surface-3: #f1f5f9;
  /* ... more tokens ... */
}
```

---

## Complete File Contents

The following sections contain the complete, unedited file contents for all critical files. These are the actual source files that need to be analyzed.

### COMPLETE FILE 1: `src/lib/theme-config.ts`

```typescript
/**
 * Theme Configuration Module
 *
 * Centralizes all theme-related constants and types for the DormWay platform.
 * Supports four visual themes: system, light, dark, and glass (glassmorphic dark).
 *
 * @example
 * ```typescript
 * import { THEME_CONFIGS, ThemeMode } from './theme-config';
 *
 * const theme: ThemeMode = 'dark';
 * const config = THEME_CONFIGS[theme === 'system' ? 'dark' : theme];
 * ```
 */

/**
 * Available theme modes
 * @public
 */
export type ThemeMode = 'system' | 'light' | 'dark' | 'glass';

/**
 * Resolved theme modes (excluding system)
 * @public
 */
export type ResolvedThemeMode = Exclude<ThemeMode, 'system'>;

/**
 * Font size options for accessibility
 * @public
 */
export type FontSizeOption = 'small' | 'medium' | 'large';

/**
 * Error types for theme operations
 */
export interface ThemeError extends Error {
  readonly code: 'THEME_LOAD_FAILED' | 'THEME_SAVE_FAILED' | 'THEME_INVALID';
  readonly theme?: ThemeMode;
  readonly details?: unknown;
}

export class ThemeLoadError extends Error implements ThemeError {
  readonly code = 'THEME_LOAD_FAILED' as const;
  readonly name = 'ThemeLoadError';

  constructor(message: string, public readonly theme?: ThemeMode, public readonly details?: unknown) {
    super(message);
  }
}

/**
 * Core design system tokens
 * These remain constant across all themes
 */
export const DESIGN_TOKENS = {
  // Brand colors - refined for better harmony
  '--ds-primary-brand': '#6366f1',
  '--ds-primary-soft': '#818cf8',
  '--ds-primary-deep': '#4f46e5',

  // Semantic colors - WCAG AA compliant
  '--ds-success': '#10b981',
  '--ds-error': '#ef4444',
  '--ds-warning': '#f59e0b',
  '--ds-info': '#3b82f6',

  // Typography - optimized font stack
  '--ds-font-family-sans': '-apple-system, BlinkMacSystemFont, "Inter", "SF Pro Display", system-ui, sans-serif',
  '--ds-font-family-mono': '"SF Mono", "JetBrains Mono", "Fira Code", "Consolas", monospace',
  '--ds-font-family-display': '-apple-system, BlinkMacSystemFont, "SF Pro Display", system-ui, sans-serif',

  // Transitions - refined timing
  '--ds-transition-fast': '0.12s cubic-bezier(0.4, 0, 0.2, 1)',
  '--ds-transition-base': '0.2s cubic-bezier(0.4, 0, 0.2, 1)',
  '--ds-transition-slow': '0.3s cubic-bezier(0.4, 0, 0.2, 1)',
  '--ds-transition-spring': '0.4s cubic-bezier(0.34, 1.56, 0.64, 1)',

  // Spacing - 8px base grid with golden ratio
  '--ds-spacing-xs': '0.25rem',    // 4px
  '--ds-spacing-sm': '0.5rem',     // 8px
  '--ds-spacing-md': '1rem',       // 16px
  '--ds-spacing-lg': '1.5rem',     // 24px
  '--ds-spacing-xl': '2rem',       // 32px
  '--ds-spacing-2xl': '3rem',      // 48px
  '--ds-spacing-3xl': '4rem',      // 64px
  '--ds-layout-gap-hero': '2rem',
  '--ds-layout-gap-section': '3rem',
  '--ds-layout-gap-stack': '1.5rem',

  // Shape tokens - refined radius scale
  '--ds-radius-sm': '0.5rem',      // 8px
  '--ds-radius-md': '0.75rem',     // 12px
  '--ds-radius-lg': '1rem',        // 16px
  '--ds-radius-xl': '1.5rem',      // 24px
  '--ds-radius-2xl': '2rem',       // 32px
  '--ds-card-radius': '1.5rem',
  '--ds-chip-radius': '9999px',

  // Z-index scale
  '--ds-z-base': '0',
  '--ds-z-dropdown': '1000',
  '--ds-z-sticky': '1100',
  '--ds-z-overlay': '1200',
  '--ds-z-modal': '1300',
  '--ds-z-popover': '1400',
  '--ds-z-toast': '1500',

  // Priority colors
  '--ds-priority-high': 'var(--ds-error)',
  '--ds-priority-medium': 'var(--ds-warning)',
  '--ds-priority-low': 'var(--ds-info)',

  // Gradient mesh for backgrounds
  '--gradient-mesh': 'radial-gradient(circle at 30% 20%, rgba(107,33,255,0.15) 0%, transparent 50%), radial-gradient(circle at 70% 60%, rgba(255,95,161,0.1) 0%, transparent 50%), radial-gradient(circle at 40% 80%, rgba(255,123,63,0.1) 0%, transparent 50%)',
} as const;

const UNIFIED_THEME_TOKENS: Record<ResolvedThemeMode, Record<string, string>> = {
  dark: {
    // Surface layers - refined contrast
    '--ds-surface-0': '#0a0c14',
    '--ds-surface-1': '#13151f',
    '--ds-surface-2': '#1a1d2a',
    '--ds-surface-3': '#22253a',

    // Input states - improved visibility
    '--ds-input-surface': '#16182a',
    '--ds-input-border': 'rgba(255, 255, 255, 0.12)',
    '--ds-input-border-focus': 'rgba(99, 102, 241, 0.6)',
    '--ds-input-border-error': 'rgba(239, 68, 68, 0.6)',

    // Border hierarchy - clear progression
    '--ds-border-1': 'rgba(255, 255, 255, 0.06)',
    '--ds-border-2': 'rgba(255, 255, 255, 0.1)',
    '--ds-border-3': 'rgba(255, 255, 255, 0.18)',
    '--ds-border-subtle': 'var(--ds-border-1)',
    '--ds-border-muted': 'var(--ds-border-2)',
    '--ds-border-strong': 'var(--ds-border-3)',

    // Shadow system - refined depth
    '--ds-shadow-1': '0 1px 2px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.15)',
    '--ds-shadow-2': '0 4px 8px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2)',
    '--ds-shadow-3': '0 12px 24px rgba(0, 0, 0, 0.35), 0 6px 12px rgba(0, 0, 0, 0.25)',
    '--ds-shadow-4': '0 24px 48px rgba(0, 0, 0, 0.4), 0 12px 24px rgba(0, 0, 0, 0.3)',
    '--ds-shadow-sm': 'var(--ds-shadow-1)',
    '--ds-shadow-base': 'var(--ds-shadow-2)',
    '--ds-shadow-md': 'var(--ds-shadow-2)',
    '--ds-shadow-lg': 'var(--ds-shadow-3)',
    '--ds-shadow-xl': 'var(--ds-shadow-4)',

    // Chips & badges - improved contrast
    '--ds-chip': 'rgba(255, 255, 255, 0.08)',
    '--ds-chip-border': 'rgba(255, 255, 255, 0.16)',
    '--ds-chip-foreground': '#e5e7eb',

    // Info indicators
    '--ds-info-text': '#c7d2fe',
    '--ds-info-indicator': 'rgba(99, 102, 241, 0.25)',

    // Status colors - WCAG AA compliant on dark
    '--ds-status-success': '#4ade80',
    '--ds-status-warning': '#fbbf24',
    '--ds-status-error': '#f87171',
    '--ds-status-info': '#60a5fa',
    '--ds-status-accent': '#a78bfa',
    '--ds-status-success-soft': 'rgba(74, 222, 128, 0.15)',
    '--ds-status-warning-soft': 'rgba(251, 191, 36, 0.15)',
    '--ds-status-error-soft': 'rgba(248, 113, 113, 0.15)',
    '--ds-status-info-soft': 'rgba(96, 165, 250, 0.15)',
    '--ds-status-success-border': 'rgba(74, 222, 128, 0.4)',
    '--ds-status-warning-border': 'rgba(251, 191, 36, 0.4)',
    '--ds-status-error-border': 'rgba(248, 113, 113, 0.4)',
    '--ds-status-info-border': 'rgba(96, 165, 250, 0.4)',

    // Badge semantic tokens (dark theme)
    '--ds-badge-error-bg': 'rgba(248, 113, 113, 0.15)',
    '--ds-badge-error-text': '#f87171',
    '--ds-badge-error-border': 'rgba(248, 113, 113, 0.3)',
    '--ds-badge-warning-bg': 'rgba(251, 191, 36, 0.15)',
    '--ds-badge-warning-text': '#fbbf24',
    '--ds-badge-warning-border': 'rgba(251, 191, 36, 0.3)',
    '--ds-badge-success-bg': 'rgba(74, 222, 128, 0.15)',
    '--ds-badge-success-text': '#4ade80',
    '--ds-badge-success-border': 'rgba(74, 222, 128, 0.3)',
    '--ds-badge-info-bg': 'rgba(96, 165, 250, 0.15)',
    '--ds-badge-info-text': '#60a5fa',
    '--ds-badge-info-border': 'rgba(96, 165, 250, 0.3)',
    '--ds-badge-neutral-bg': 'var(--ds-chip)',
    '--ds-badge-neutral-text': 'var(--ds-chip-foreground)',
    '--ds-badge-neutral-border': 'var(--ds-chip-border)',

    // Buttons - enhanced states
    '--ds-button-bg': '#6366f1',
    '--ds-button-fg': '#ffffff',
    '--ds-button-border': 'rgba(99, 102, 241, 0.5)',
    '--ds-button-hover-bg': '#7c3aed',
    '--ds-button-hover-shadow': '0 4px 12px rgba(99, 102, 241, 0.4)',
    '--ds-button-active-bg': '#5b21b6',
    '--ds-button-muted-bg': '#1a1d2a',
    '--ds-button-muted-fg': '#d1d5db',
    '--ds-button-muted-border': 'rgba(255, 255, 255, 0.12)',
    '--ds-button-outline-bg': 'transparent',
    '--ds-button-outline-border': 'rgba(255, 255, 255, 0.2)',
    '--ds-button-outline-fg': '#e5e7eb',
    '--ds-button-ghost-hover-bg': 'rgba(99, 102, 241, 0.1)',

    // Sidebar - refined navigation
    '--ds-sidebar-bg': '#13151f',
    '--ds-sidebar-border': 'rgba(255, 255, 255, 0.08)',
    '--ds-sidebar-foreground': '#f3f4f6',
    '--ds-sidebar-muted': '#9ca3af',
    '--ds-sidebar-hover-bg': 'rgba(255, 255, 255, 0.06)',
    '--ds-sidebar-active-bg': 'rgba(99, 102, 241, 0.15)',
    '--ds-sidebar-active-border': 'rgba(99, 102, 241, 0.5)',
    '--ds-sidebar-active-fg': '#ffffff',
    '--ds-sidebar-active-ring': 'rgba(99, 102, 241, 0.4)',
    '--ds-sidebar-active-indicator': '#6366f1',
    '--ds-sidebar-pill-shadow': '0 4px 12px rgba(0, 0, 0, 0.3)',
    '--ds-sidebar-accent': 'rgba(99, 102, 241, 0.2)',
    '--ds-sidebar-overlay': 'linear-gradient(to left, rgba(19, 21, 31, 0.4), transparent)',

    // Hero sections
    '--ds-hero-background': 'linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(59, 130, 246, 0.1) 50%, rgba(10, 12, 20, 0.95) 100%)',
    '--ds-hero-overlay': 'rgba(10, 12, 20, 0.4)',
    '--ds-hero-gradient-strength': '0.8',
    '--ds-hero-cta-bg': '#6366f1',
    '--ds-hero-cta-fg': '#ffffff',
    '--ds-hero-cta-border': 'rgba(99, 102, 241, 0.5)',
    '--ds-hero-accent': 'rgba(147, 197, 253, 0.2)',
    '--ds-hero-shadow': '0 20px 40px rgba(0, 0, 0, 0.4)',
    '--ds-hero-divider': 'rgba(255, 255, 255, 0.1)',

    // Utility colors
    '--ds-today-tint': 'rgba(59, 130, 246, 0.15)',
    '--ds-danger-fg': '#f87171',
    '--ds-danger-bg-hover': 'rgba(248, 113, 113, 0.12)',
    '--ds-danger-contrast': '#ffffff',

    // Chart colors - improved readability
    '--ds-chart-grid': 'rgba(255, 255, 255, 0.1)',
    '--ds-chart-bg': 'rgba(19, 21, 31, 0.6)',
    '--ds-chart-legend-bg': 'rgba(255, 255, 255, 0.06)',
    '--ds-chart-legend-border': 'rgba(255, 255, 255, 0.12)',

    // Overlay and popover backgrounds
    '--ds-overlay-bg': 'rgba(0, 0, 0, 0.65)',
    '--ds-popover-bg': 'rgba(19, 21, 31, 0.95)',
  },
  glass: {
    // Transparent surfaces - glassmorphic effect
    '--ds-surface-0': 'transparent',
    '--ds-surface-1': 'rgba(10, 14, 28, 0.3)',
    '--ds-surface-2': 'rgba(15, 20, 35, 0.35)',
    '--ds-surface-3': 'rgba(20, 26, 42, 0.4)',

    // Input states - enhanced glass
    '--ds-input-surface': 'rgba(10, 15, 30, 0.4)',
    '--ds-input-border': 'rgba(255, 255, 255, 0.2)',
    '--ds-input-border-focus': 'rgba(99, 102, 241, 0.7)',
    '--ds-input-border-error': 'rgba(239, 68, 68, 0.7)',

    // Borders - glass effect with luminosity
    '--ds-border-1': 'rgba(255, 255, 255, 0.12)',
    '--ds-border-2': 'rgba(255, 255, 255, 0.18)',
    '--ds-border-3': 'rgba(255, 255, 255, 0.28)',
    '--ds-border-subtle': 'var(--ds-border-1)',
    '--ds-border-muted': 'var(--ds-border-2)',
    '--ds-border-strong': 'var(--ds-border-3)',

    // Enhanced shadow system for glass
    '--ds-shadow-1': '0 2px 8px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
    '--ds-shadow-2': '0 8px 16px rgba(0, 0, 0, 0.25), 0 4px 8px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
    '--ds-shadow-3': '0 16px 32px rgba(0, 0, 0, 0.3), 0 8px 16px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.12)',
    '--ds-shadow-4': '0 32px 64px rgba(0, 0, 0, 0.35), 0 16px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.12)',
    '--ds-shadow-sm': 'var(--ds-shadow-1)',
    '--ds-shadow-base': 'var(--ds-shadow-2)',
    '--ds-shadow-md': 'var(--ds-shadow-2)',
    '--ds-shadow-lg': 'var(--ds-shadow-3)',
    '--ds-shadow-xl': 'var(--ds-shadow-4)',

    // Chips & badges - glass style
    '--ds-chip': 'rgba(99, 102, 241, 0.15)',
    '--ds-chip-border': 'rgba(255, 255, 255, 0.25)',
    '--ds-chip-foreground': '#f0f4ff',

    // Info indicators
    '--ds-info-text': '#dbe4ff',
    '--ds-info-indicator': 'rgba(99, 102, 241, 0.3)',

    // Status colors - vibrant for glass
    '--ds-status-success': '#4ade80',
    '--ds-status-warning': '#fbbf24',
    '--ds-status-error': '#f87171',
    '--ds-status-info': '#60a5fa',
    '--ds-status-accent': '#a78bfa',
    '--ds-status-success-soft': 'rgba(74, 222, 128, 0.2)',
    '--ds-status-warning-soft': 'rgba(251, 191, 36, 0.2)',
    '--ds-status-error-soft': 'rgba(248, 113, 113, 0.2)',
    '--ds-status-info-soft': 'rgba(96, 165, 250, 0.2)',
    '--ds-status-success-border': 'rgba(74, 222, 128, 0.5)',
    '--ds-status-warning-border': 'rgba(251, 191, 36, 0.5)',
    '--ds-status-error-border': 'rgba(248, 113, 113, 0.5)',
    '--ds-status-info-border': 'rgba(96, 165, 250, 0.5)',

    // Badge semantic tokens (glass theme)
    '--ds-badge-error-bg': 'rgba(248, 113, 113, 0.2)',
    '--ds-badge-error-text': '#f87171',
    '--ds-badge-error-border': 'rgba(248, 113, 113, 0.35)',
    '--ds-badge-warning-bg': 'rgba(251, 191, 36, 0.2)',
    '--ds-badge-warning-text': '#fbbf24',
    '--ds-badge-warning-border': 'rgba(251, 191, 36, 0.35)',
    '--ds-badge-success-bg': 'rgba(74, 222, 128, 0.2)',
    '--ds-badge-success-text': '#4ade80',
    '--ds-badge-success-border': 'rgba(74, 222, 128, 0.35)',
    '--ds-badge-info-bg': 'rgba(96, 165, 250, 0.2)',
    '--ds-badge-info-text': '#60a5fa',
    '--ds-badge-info-border': 'rgba(96, 165, 250, 0.35)',
    '--ds-badge-neutral-bg': 'var(--ds-chip)',
    '--ds-badge-neutral-text': 'var(--ds-chip-foreground)',
    '--ds-badge-neutral-border': 'var(--ds-chip-border)',

    // Buttons - glass morphism
    '--ds-button-bg': 'rgba(99, 102, 241, 0.9)',
    '--ds-button-fg': '#ffffff',
    '--ds-button-border': 'rgba(99, 102, 241, 0.6)',
    '--ds-button-hover-bg': 'rgba(124, 58, 237, 0.95)',
    '--ds-button-hover-shadow': '0 8px 20px rgba(99, 102, 241, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)',
    '--ds-button-active-bg': 'rgba(91, 33, 182, 0.95)',
    '--ds-button-muted-bg': 'rgba(10, 15, 30, 0.5)',
    '--ds-button-muted-fg': '#d1d5db',
    '--ds-button-muted-border': 'rgba(255, 255, 255, 0.18)',
    '--ds-button-outline-bg': 'rgba(255, 255, 255, 0.05)',
    '--ds-button-outline-border': 'rgba(255, 255, 255, 0.25)',
    '--ds-button-outline-fg': '#f3f4f6',
    '--ds-button-ghost-hover-bg': 'rgba(99, 102, 241, 0.15)',

    // Sidebar - glass navigation
    '--ds-sidebar-bg': 'rgba(10, 14, 28, 0.3)',
    '--ds-sidebar-border': 'rgba(255, 255, 255, 0.15)',
    '--ds-sidebar-foreground': '#f8fafc',
    '--ds-sidebar-muted': '#b8c5ff',
    '--ds-sidebar-hover-bg': 'rgba(255, 255, 255, 0.08)',
    '--ds-sidebar-active-bg': 'rgba(99, 102, 241, 0.25)',
    '--ds-sidebar-active-border': 'rgba(99, 102, 241, 0.6)',
    '--ds-sidebar-active-fg': '#ffffff',
    '--ds-sidebar-active-ring': 'rgba(99, 102, 241, 0.5)',
    '--ds-sidebar-active-indicator': '#6366f1',
    '--ds-sidebar-pill-shadow': '0 8px 20px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.15)',
    '--ds-sidebar-accent': 'rgba(99, 102, 241, 0.25)',
    '--ds-sidebar-overlay': 'linear-gradient(to left, rgba(10, 14, 28, 0.5), transparent)',

    // Hero sections - enhanced glass
    '--ds-hero-background': 'linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(59, 130, 246, 0.15) 50%, rgba(8, 10, 20, 0.9) 100%)',
    '--ds-hero-overlay': 'rgba(6, 8, 18, 0.3)',
    '--ds-hero-gradient-strength': '0.75',
    '--ds-hero-cta-bg': 'rgba(99, 102, 241, 0.95)',
    '--ds-hero-cta-fg': '#ffffff',
    '--ds-hero-cta-border': 'rgba(99, 102, 241, 0.6)',
    '--ds-hero-accent': 'rgba(147, 197, 253, 0.25)',
    '--ds-hero-shadow': '0 24px 48px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
    '--ds-hero-divider': 'rgba(255, 255, 255, 0.15)',

    // Utility colors
    '--ds-today-tint': 'rgba(59, 130, 246, 0.2)',
    '--ds-danger-fg': '#f87171',
    '--ds-danger-bg-hover': 'rgba(248, 113, 113, 0.18)',
    '--ds-danger-contrast': '#ffffff',

    // Chart colors - glass optimized
    '--ds-chart-grid': 'rgba(255, 255, 255, 0.15)',
    '--ds-chart-bg': 'rgba(10, 15, 30, 0.4)',
    '--ds-chart-legend-bg': 'rgba(99, 102, 241, 0.1)',
    '--ds-chart-legend-border': 'rgba(255, 255, 255, 0.2)',

    // Overlay and popover backgrounds - glass optimized for readability
    '--ds-overlay-bg': 'rgba(4, 6, 18, 0.5)',
    '--ds-popover-bg': 'rgba(10, 16, 34, 0.88)',
  },
  light: {
    // Surface layers - clean and bright
    '--ds-surface-0': '#f8f9fb',
    '--ds-surface-1': '#ffffff',
    '--ds-surface-2': '#f1f3f5',
    '--ds-surface-3': '#e9ecef',

    // Input states - clear visibility
    '--ds-input-surface': '#ffffff',
    '--ds-input-border': 'rgba(15, 23, 42, 0.15)',
    '--ds-input-border-focus': 'rgba(99, 102, 241, 0.6)',
    '--ds-input-border-error': 'rgba(220, 38, 38, 0.6)',

    // Border hierarchy - subtle to strong
    '--ds-border-1': 'rgba(15, 23, 42, 0.08)',
    '--ds-border-2': 'rgba(15, 23, 42, 0.12)',
    '--ds-border-3': 'rgba(15, 23, 42, 0.2)',
    '--ds-border-subtle': 'var(--ds-border-1)',
    '--ds-border-muted': 'var(--ds-border-2)',
    '--ds-border-strong': 'var(--ds-border-3)',

    // Shadow system - refined depth
    '--ds-shadow-1': '0 1px 3px rgba(15, 23, 42, 0.08), 0 1px 2px rgba(15, 23, 42, 0.06)',
    '--ds-shadow-2': '0 4px 6px rgba(15, 23, 42, 0.1), 0 2px 4px rgba(15, 23, 42, 0.06)',
    '--ds-shadow-3': '0 10px 15px rgba(15, 23, 42, 0.12), 0 4px 6px rgba(15, 23, 42, 0.08)',
    '--ds-shadow-4': '0 20px 25px rgba(15, 23, 42, 0.15), 0 8px 10px rgba(15, 23, 42, 0.1)',
    '--ds-shadow-sm': 'var(--ds-shadow-1)',
    '--ds-shadow-base': 'var(--ds-shadow-2)',
    '--ds-shadow-md': 'var(--ds-shadow-2)',
    '--ds-shadow-lg': 'var(--ds-shadow-3)',
    '--ds-shadow-xl': 'var(--ds-shadow-4)',

    // Chips & badges - subtle yet visible
    '--ds-chip': 'rgba(15, 23, 42, 0.05)',
    '--ds-chip-border': 'rgba(15, 23, 42, 0.1)',
    '--ds-chip-foreground': '#1e293b',

    // Info indicators
    '--ds-info-text': '#334155',
    '--ds-info-indicator': 'rgba(99, 102, 241, 0.15)',

    // Status colors - WCAG AA compliant on white
    '--ds-status-success': '#16a34a',
    '--ds-status-warning': '#d97706',
    '--ds-status-error': '#dc2626',
    '--ds-status-info': '#2563eb',
    '--ds-status-accent': '#7c3aed',
    '--ds-status-success-soft': 'rgba(22, 163, 74, 0.1)',
    '--ds-status-warning-soft': 'rgba(217, 119, 6, 0.1)',
    '--ds-status-error-soft': 'rgba(220, 38, 38, 0.1)',
    '--ds-status-info-soft': 'rgba(37, 99, 235, 0.1)',
    '--ds-status-success-border': 'rgba(22, 163, 74, 0.3)',
    '--ds-status-warning-border': 'rgba(217, 119, 6, 0.3)',
    '--ds-status-error-border': 'rgba(220, 38, 38, 0.3)',
    '--ds-status-info-border': 'rgba(37, 99, 235, 0.3)',

    // Badge semantic tokens (light theme - darker for better contrast)
    '--ds-badge-error-bg': 'rgba(220, 38, 38, 0.1)',
    '--ds-badge-error-text': '#b91c1c',
    '--ds-badge-error-border': 'rgba(185, 28, 28, 0.3)',
    '--ds-badge-warning-bg': 'rgba(217, 119, 6, 0.1)',
    '--ds-badge-warning-text': '#b45309',
    '--ds-badge-warning-border': 'rgba(180, 83, 9, 0.3)',
    '--ds-badge-success-bg': 'rgba(22, 163, 74, 0.1)',
    '--ds-badge-success-text': '#15803d',
    '--ds-badge-success-border': 'rgba(21, 128, 61, 0.3)',
    '--ds-badge-info-bg': 'rgba(37, 99, 235, 0.1)',
    '--ds-badge-info-text': '#1d4ed8',
    '--ds-badge-info-border': 'rgba(29, 78, 216, 0.3)',
    '--ds-badge-neutral-bg': 'var(--ds-chip)',
    '--ds-badge-neutral-text': 'var(--ds-chip-foreground)',
    '--ds-badge-neutral-border': 'var(--ds-chip-border)',

    // Buttons - crisp and clear
    '--ds-button-bg': '#6366f1',
    '--ds-button-fg': '#ffffff',
    '--ds-button-border': 'rgba(99, 102, 241, 0.5)',
    '--ds-button-hover-bg': '#7c3aed',
    '--ds-button-hover-shadow': '0 4px 12px rgba(99, 102, 241, 0.3)',
    '--ds-button-active-bg': '#5b21b6',
    '--ds-button-muted-bg': '#f1f3f5',
    '--ds-button-muted-fg': '#1e293b',
    '--ds-button-muted-border': 'rgba(15, 23, 42, 0.12)',
    '--ds-button-outline-bg': 'transparent',
    '--ds-button-outline-border': 'rgba(99, 102, 241, 0.4)',
    '--ds-button-outline-fg': '#4f46e5',
    '--ds-button-ghost-hover-bg': 'rgba(99, 102, 241, 0.08)',

    // Sidebar - bright navigation
    '--ds-sidebar-bg': '#ffffff',
    '--ds-sidebar-border': 'rgba(15, 23, 42, 0.1)',
    '--ds-sidebar-foreground': '#0f172a',
    '--ds-sidebar-muted': '#64748b',
    '--ds-sidebar-hover-bg': 'rgba(99, 102, 241, 0.05)',
    '--ds-sidebar-active-bg': 'rgba(99, 102, 241, 0.1)',
    '--ds-sidebar-active-border': 'rgba(99, 102, 241, 0.4)',
    '--ds-sidebar-active-fg': '#1e1b4b',
    '--ds-sidebar-active-ring': 'rgba(99, 102, 241, 0.3)',
    '--ds-sidebar-active-indicator': '#6366f1',
    '--ds-sidebar-pill-shadow': '0 2px 8px rgba(15, 23, 42, 0.1)',
    '--ds-sidebar-accent': 'rgba(99, 102, 241, 0.12)',
    '--ds-sidebar-overlay': 'linear-gradient(to left, rgba(241, 243, 245, 0.8), transparent)',

    // Hero sections
    '--ds-hero-background': 'linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(59, 130, 246, 0.06) 50%, rgba(236, 72, 153, 0.05) 100%)',
    '--ds-hero-overlay': 'rgba(255, 255, 255, 0.4)',
    '--ds-hero-gradient-strength': '0.85',
    '--ds-hero-cta-bg': '#6366f1',
    '--ds-hero-cta-fg': '#ffffff',
    '--ds-hero-cta-border': 'rgba(99, 102, 241, 0.5)',
    '--ds-hero-accent': 'rgba(99, 102, 241, 0.12)',
    '--ds-hero-shadow': '0 10px 20px rgba(15, 23, 42, 0.12)',
    '--ds-hero-divider': 'rgba(15, 23, 42, 0.12)',

    // Utility colors
    '--ds-today-tint': 'rgba(59, 130, 246, 0.08)',
    '--ds-danger-fg': '#dc2626',
    '--ds-danger-bg-hover': 'rgba(220, 38, 38, 0.08)',
    '--ds-danger-contrast': '#ffffff',

    // Chart colors - clean and readable
    '--ds-chart-grid': 'rgba(15, 23, 42, 0.08)',
    '--ds-chart-bg': 'rgba(255, 255, 255, 0.8)',
    '--ds-chart-legend-bg': 'rgba(15, 23, 42, 0.04)',
    '--ds-chart-legend-border': 'rgba(15, 23, 42, 0.1)',

    // Overlay and popover backgrounds
    '--ds-overlay-bg': 'rgba(0, 0, 0, 0.35)',
    '--ds-popover-bg': 'rgba(255, 255, 255, 0.98)',
  },
} as const;

/**
 * Configuration for a specific theme
 */
interface ThemeConfig {
  /** CSS classes to apply to document root */
  readonly classes: readonly string[];
  /** Browser color scheme preference */
  readonly colorScheme: 'light' | 'dark';
  /** CSS custom properties for colors */
  readonly colors: Record<string, string>;
}

/**
 * Complete theme configuration mapping
 *
 * Each theme includes:
 * - CSS classes for framework integration
 * - Color scheme for native browser elements
 * - Custom CSS properties for colors
 *
 * @example
 * ```typescript
 * const darkTheme = THEME_CONFIGS.dark;
 * console.log(darkTheme.classes); // ['dark']
 * console.log(darkTheme.colorScheme); // 'dark'
 * ```
 */
export const THEME_CONFIGS: Record<ResolvedThemeMode, ThemeConfig> = {
  dark: {
    classes: ['dark'],
    colorScheme: 'dark' as const,
    colors: {
      ...UNIFIED_THEME_TOKENS.dark,

      // Core colors
      '--bg-primary': '#0b0d18',
      '--bg-secondary': '#121421',
      '--bg-tertiary': '#191c2a',
      '--bg-card': '#191c2e',
      '--fg': '#f8fafc',
      '--fg-muted': '#94a3b8',
      '--fg-subtle': '#64748b',

      // Accent gradients
      '--gradient-primary': 'linear-gradient(135deg, #8b5cf6 0%, #ec4899 50%, #f97316 100%)',
      '--gradient-secondary': 'linear-gradient(135deg, #a78bfa 0%, #f472b6 100%)',
      '--gradient-tertiary': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
      '--gradient-mesh': 'none',

      // Borders
      '--border-color': 'var(--ds-border-1)',
      '--border-hover': 'var(--ds-border-2)',

      // Design system backgrounds and text colors
      '--ds-bg-primary': '#0b0d18',
      '--ds-bg-secondary': '#121421',
      '--ds-bg-tertiary': '#1a1d2b',
      '--ds-bg-surface': 'var(--ds-surface-1)',
      '--ds-bg-surface-secondary': 'var(--ds-surface-2)',
      '--ds-bg-card': 'var(--ds-surface-1)',
      '--ds-bg-card-hover': 'var(--ds-surface-2)',
      '--ds-text-primary': '#f8fafc',
      '--ds-text-secondary': '#e2e5ea',
      '--ds-text-tertiary': '#a8b3c5',
      '--ds-text-muted': '#94a3b8',
      '--ds-text-accent': '#c4b5fd',

      // Role tokens
      '--surface': 'var(--ds-surface-0)',
      '--surface-elevated': 'var(--ds-surface-2)',
      '--text-primary': 'var(--ds-text-primary)',
      '--text-secondary': 'var(--ds-text-secondary)',
      '--text-muted': 'var(--ds-text-muted)',
      '--border': 'var(--ds-border-1)',
      '--border-strong': 'var(--ds-border-3)',
      '--ring': 'rgba(99, 102, 241, 0.45)',
      '--btn-bg': 'var(--ds-button-bg)',
      '--btn-fg': 'var(--ds-button-fg)',
      '--btn-border': 'var(--ds-button-border)',
      '--btn-muted-bg': 'var(--ds-button-muted-bg)',
      '--btn-muted-fg': 'var(--ds-button-muted-fg)',
      '--btn-muted-border': 'var(--ds-button-muted-border)',
      '--today-tint': 'var(--ds-today-tint)',
      '--danger-fg': 'var(--ds-danger-fg)',
      '--danger-bg-hover': 'var(--ds-danger-bg-hover)',
      '--danger-contrast': 'var(--ds-danger-contrast)',

      // Overlays and modals
      '--overlay': 'rgba(0, 0, 0, 0.8)',
      '--overlay-light': 'rgba(0, 0, 0, 0.6)',
      '--backdrop': 'rgba(10, 10, 15, 0.85)',

      // Glass surface tokens
      '--glass-bg-light': 'rgba(18, 18, 32, 0.55)',
      '--glass-bg-medium': 'rgba(16, 16, 28, 0.72)',
      '--glass-bg-strong': 'rgba(12, 12, 24, 0.88)',
      '--glass-border': 'rgba(255, 255, 255, 0.12)',

      // Loading and skeleton states
      '--skeleton-primary': 'rgba(255, 255, 255, 0.1)',
      '--skeleton-secondary': 'rgba(255, 255, 255, 0.05)',
      '--loading-bg': 'rgba(255, 255, 255, 0.08)',
    },
  },

  glass: {
    classes: ['dark', 'glass'],
    colorScheme: 'dark' as const,
    colors: {
      ...UNIFIED_THEME_TOKENS.glass,

      '--bg-primary': 'transparent',
      '--bg-secondary': 'transparent',
      '--bg-tertiary': 'transparent',
      '--bg-card': 'transparent',
      '--fg': '#f9fbff',
      '--fg-muted': '#d8defa',
      '--fg-subtle': '#aab6ff',

      '--gradient-primary': 'linear-gradient(135deg, rgba(124, 131, 255, 0.7) 0%, rgba(236, 72, 153, 0.45) 55%, rgba(59, 130, 246, 0.48) 100%)',
      '--gradient-secondary': 'linear-gradient(135deg, rgba(166, 193, 255, 0.65) 0%, rgba(124, 131, 255, 0.7) 100%)',
      '--gradient-tertiary': 'linear-gradient(135deg, rgba(34, 211, 238, 0.4) 0%, rgba(124, 131, 255, 0.55) 100%)',
      '--gradient-mesh': 'none',

      '--border-color': 'var(--ds-border-1)',
      '--border-hover': 'var(--ds-border-2)',

      '--ds-bg-primary': 'transparent',
      '--ds-bg-secondary': 'transparent',
      '--ds-bg-tertiary': 'transparent',
      '--ds-bg-surface': 'transparent',
      '--ds-bg-surface-secondary': 'transparent',
      '--ds-bg-card': 'transparent',
      '--ds-bg-card-hover': 'rgba(14, 20, 40, 0.35)',

      '--ds-text-primary': '#f9fbff',
      '--ds-text-secondary': '#e6ebff',
      '--ds-text-tertiary': '#c7d0ff',
      '--ds-text-muted': '#b3bef5',
      '--ds-text-accent': '#c7d2ff',

      '--surface': 'transparent',
      '--surface-elevated': 'transparent',
      '--text-primary': 'var(--ds-text-primary)',
      '--text-secondary': 'var(--ds-text-secondary)',
      '--text-muted': 'var(--ds-text-muted)',
      '--border': 'var(--ds-border-1)',
      '--border-strong': 'var(--ds-border-3)',
      '--ring': 'rgba(124, 131, 255, 0.6)',
      '--btn-bg': 'var(--ds-button-bg)',
      '--btn-fg': 'var(--ds-button-fg)',
      '--btn-border': 'var(--ds-button-border)',
      '--btn-muted-bg': 'var(--ds-button-muted-bg)',
      '--btn-muted-fg': 'var(--ds-button-muted-fg)',
      '--btn-muted-border': 'var(--ds-button-muted-border)',
      '--today-tint': 'var(--ds-today-tint)',
      '--danger-fg': 'var(--ds-danger-fg)',
      '--danger-bg-hover': 'var(--ds-danger-bg-hover)',
      '--danger-contrast': 'var(--ds-danger-contrast)',

      '--overlay': 'rgba(4, 6, 18, 0.6)',
      '--overlay-light': 'rgba(6, 8, 20, 0.35)',
      '--backdrop': 'rgba(10, 12, 26, 0.6)',

      '--glass-bg-light': 'rgba(12, 18, 36, 0.55)',
      '--glass-bg-medium': 'rgba(10, 16, 34, 0.72)',
      '--glass-bg-strong': 'rgba(8, 12, 28, 0.85)',
      '--glass-border': 'rgba(173, 195, 255, 0.4)',

      '--skeleton-primary': 'rgba(219, 234, 254, 0.15)',
      '--skeleton-secondary': 'rgba(191, 219, 254, 0.08)',
      '--loading-bg': 'rgba(124, 131, 255, 0.2)',

      '--panel': 'transparent',
   },
  },

  light: {
    classes: ['light'],
    colorScheme: 'light' as const,
    colors: {
      ...UNIFIED_THEME_TOKENS.light,

      // Core colors
      '--bg-primary': '#ffffff',
      '--bg-secondary': '#f9fafb',
      '--bg-tertiary': '#f3f4f6',
      '--bg-card': '#ffffff',
      '--fg': '#0f172a',
      '--fg-muted': '#64748b',
      '--fg-subtle': '#9ca3af',

      // Accent gradients
      '--gradient-primary': 'linear-gradient(135deg, #8b5cf6 0%, #ec4899 50%, #f97316 100%)',
      '--gradient-secondary': 'linear-gradient(135deg, #a78bfa 0%, #f472b6 100%)',
      '--gradient-tertiary': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
      '--gradient-mesh': 'none',

      // Borders
      '--border-color': 'var(--ds-border-1)',
      '--border-hover': 'var(--ds-border-2)',

      // Design system backgrounds
      '--ds-bg-primary': '#f5f5fa',
      '--ds-bg-secondary': '#ffffff',
      '--ds-bg-tertiary': '#eef1f8',
      '--ds-bg-surface': 'var(--ds-surface-1)',
      '--ds-bg-surface-secondary': 'var(--ds-surface-2)',
      '--ds-bg-card': 'var(--ds-surface-1)',
      '--ds-bg-card-hover': 'var(--ds-surface-2)',

      // Design system text colors
      '--ds-text-primary': '#111827',
      '--ds-text-secondary': '#334155',
      '--ds-text-tertiary': '#475569',
      '--ds-text-muted': '#64748b',
      '--ds-text-accent': '#4c1d95',

      // Role tokens
      '--surface': 'var(--ds-surface-0)',
      '--surface-elevated': 'var(--ds-surface-2)',
      '--text-primary': 'var(--ds-text-primary)',
      '--text-secondary': 'var(--ds-text-secondary)',
      '--text-muted': 'var(--ds-text-muted)',
      '--border': 'var(--ds-border-1)',
      '--border-strong': 'var(--ds-border-3)',
      '--ring': 'rgba(99, 102, 241, 0.45)',
      '--btn-bg': 'var(--ds-button-bg)',
      '--btn-fg': 'var(--ds-button-fg)',
      '--btn-border': 'var(--ds-button-border)',
      '--btn-muted-bg': 'var(--ds-button-muted-bg)',
      '--btn-muted-fg': 'var(--ds-button-muted-fg)',
      '--btn-muted-border': 'var(--ds-button-muted-border)',
      '--today-tint': 'var(--ds-today-tint)',
      '--danger-fg': 'var(--ds-danger-fg)',
      '--danger-bg-hover': 'var(--ds-danger-bg-hover)',
      '--danger-contrast': 'var(--ds-danger-contrast)',

      // Overlays and modals
      '--overlay': 'rgba(0, 0, 0, 0.4)',
      '--overlay-light': 'rgba(0, 0, 0, 0.25)',
      '--backdrop': 'rgba(255, 255, 255, 0.95)',

      // Glass surface tokens
      '--glass-bg-light': 'rgba(255, 255, 255, 0.78)',
      '--glass-bg-medium': 'rgba(255, 255, 255, 0.86)',
      '--glass-bg-strong': 'rgba(255, 255, 255, 0.94)',
      '--glass-border': 'rgba(17, 24, 39, 0.12)',

      // Loading and skeleton states
      '--skeleton-primary': 'rgba(17, 24, 39, 0.1)',
      '--skeleton-secondary': 'rgba(17, 24, 39, 0.05)',
      '--loading-bg': 'rgba(17, 24, 39, 0.08)',

      // Panels
      '--panel': 'rgba(255, 255, 255, 0.8)',
    },
  },
} as const;

/**
 * Simplified accent system
 * Only keeping the most essential accent color (brand orange)
 * Can be extended later if needed
 */
export const ACCENT_COLOR = {
  '--theme-accent': 'linear-gradient(135deg, #f59e0b 0%, #ea580c 100%)',
  '--theme-accent-primary': '#f59e0b',
  '--theme-accent-secondary': '#ea580c',
  '--theme-accent-ring': 'rgba(245, 158, 11, 0.45)',
  '--theme-accent-muted': 'rgba(245, 158, 11, 0.18)',
} as const;

/**
 * Font size configurations
 *
 * Comprehensive typographic scale with 1.25 (major third) ratio
 * Maintains backward compatibility with small/medium/large presets
 */
export const FONT_SIZES = {
  // Legacy presets (backward compatible)
  small: '0.875rem',    // 14px
  medium: '1rem',       // 16px (base)
  large: '1.125rem',    // 18px

  // Granular scale for precise control
  xs: '0.75rem',        // 12px - captions, metadata, fine print
  sm: '0.875rem',       // 14px - secondary text, labels
  base: '1rem',         // 16px - body text (WCAG AA recommended minimum)
  md: '1rem',           // 16px - alias for base
  lg: '1.125rem',       // 18px - emphasized body text
  xl: '1.25rem',        // 20px - small headings, lead text
  '2xl': '1.5rem',      // 24px - section headings (h3)
  '3xl': '1.875rem',    // 30px - page headings (h2)
  '4xl': '2.25rem',     // 36px - major headings (h1)
  '5xl': '3rem',        // 48px - hero text, display type
} as const;

/**
 * Default preferences
 */
export const DEFAULT_PREFERENCES = {
  theme: 'system' as ThemeMode,
  fontSize: 'medium' as FontSizeOption,
  sidebarCollapsed: false,
} as const;
```

### COMPLETE FILE 2: `src/contexts/ThemeContext.tsx`

```typescript
"use client";

import {
  createContext,
  useContext,
  useEffect,
  useLayoutEffect,
  useMemo,
  useState,
  useCallback,
  useRef,
  ReactNode,
} from 'react';
import { patchPreferences } from '@/lib/preferences';
import {
  ThemeMode,
  ResolvedThemeMode,
  FontSizeOption,
  DESIGN_TOKENS,
  THEME_CONFIGS,
  ACCENT_COLOR,
  FONT_SIZES,
  DEFAULT_PREFERENCES,
} from '@/lib/theme-config';
import {
  StoredPreferences,
  readStoredPreferences,
  persistPreferences,
  getSystemTheme,
  dispatchThemeChange,
} from '@/lib/theme-utils';
import { sanitizeDormwayStorage } from '@/lib/storage/sanitizer';

type ThemeContextType = {
  theme: ThemeMode;
  resolvedTheme: ResolvedThemeMode;
  fontSize: FontSizeOption;
  sidebarCollapsed: boolean;
  isLoading: boolean;
  error: string | null;
  updateTheme: (theme: ThemeMode) => Promise<void>;
  updateFontSize: (size: FontSizeOption) => Promise<void>;
  updateSidebarCollapsed: (collapsed: boolean) => Promise<void>;
};

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

/**
 * Enhanced apply theme to DOM with performance optimizations
 */
function applyTheme(theme: ResolvedThemeMode, fontSize: FontSizeOption) {
  if (typeof window === 'undefined') return;

  // Use requestAnimationFrame for non-blocking updates
  requestAnimationFrame(() => {
    const root = document.documentElement;
    const bodyEl = document.body;
    const config = THEME_CONFIGS[theme];

    // Preserve focus during transition
    const activeElement = document.activeElement as HTMLElement;
    const restoreFocus = () => {
      if (activeElement && typeof activeElement.focus === 'function') {
        setTimeout(() => {
          try {
            activeElement.focus();
          } catch (error) {
            // Ignore focus errors
          }
        }, 50);
      }
    };

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!prefersReducedMotion) {
      root.classList.add('theme-transitioning');
      setTimeout(() => root.classList.remove('theme-transitioning'), 300);
    }

    // Batch DOM class changes
    const allThemeClasses = Array.from(
      new Set(
        Object.values(THEME_CONFIGS)
          .flatMap(cfg => cfg.classes)
      )
    );
    const fontSizeClasses = ['font-small', 'font-medium', 'font-large'];
    root.classList.remove(...allThemeClasses, ...fontSizeClasses);
    root.classList.add(...config.classes, `font-${fontSize}`);
    if (bodyEl) {
      bodyEl.classList.remove(...allThemeClasses, ...fontSizeClasses);
      bodyEl.classList.add(...config.classes, `font-${fontSize}`);
    }

    // Batch style updates
    const styleUpdates = {
      ...config.colors,
      ...DESIGN_TOKENS,
      ...ACCENT_COLOR,
      '--theme-font-size': FONT_SIZES[fontSize],
    };

    // Single style update pass
    Object.entries(styleUpdates).forEach(([key, value]) => {
      root.style.setProperty(key, value);
    });

    // Set color scheme for native elements
    root.style.colorScheme = config.colorScheme;

    // Set data attributes for CSS targeting
    root.dataset.theme = theme;
    root.dataset.fontSize = fontSize;

    // Update browser theme color
    const metaThemeColor = document.querySelector('meta[name="theme-color"]') as HTMLMetaElement;
    if (metaThemeColor) {
      metaThemeColor.setAttribute('content', config.colors['--bg-primary'] || '#000000');
    }

    // Announce change to screen readers
    let liveRegion = document.getElementById('theme-announcements');
    if (!liveRegion) {
      liveRegion = document.createElement('div');
      liveRegion.id = 'theme-announcements';
      liveRegion.setAttribute('aria-live', 'polite');
      liveRegion.style.position = 'absolute';
      liveRegion.style.left = '-10000px';
      liveRegion.style.width = '1px';
      liveRegion.style.height = '1px';
      liveRegion.style.overflow = 'hidden';
      document.body.appendChild(liveRegion);
    }
    liveRegion.textContent = `Theme changed to ${theme} mode with ${fontSize} font size`;

    // Restore focus
    restoreFocus();
  });
}

export function ThemeProvider({ children }: { children: ReactNode }) {
  const [theme, setTheme] = useState<ThemeMode>(DEFAULT_PREFERENCES.theme);
  const [fontSize, setFontSize] = useState<FontSizeOption>(DEFAULT_PREFERENCES.fontSize);
  const [sidebarCollapsed, setSidebarCollapsed] = useState<boolean>(DEFAULT_PREFERENCES.sidebarCollapsed);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Debounced persistence to prevent excessive backend calls
  const saveTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  // Resolve system theme to actual theme
  const [resolvedTheme, setResolvedTheme] = useState<ResolvedThemeMode>(() => {
    if (theme === 'system') {
      return getSystemTheme();
    }
    return theme;
  });

  // Apply theme on mount and changes
  useLayoutEffect(() => {
    const currentTheme = theme === 'system' ? getSystemTheme() : theme;
    setResolvedTheme(currentTheme);
    applyTheme(currentTheme, fontSize);
  }, [theme, fontSize]);

  // Hydrate preferences from storage on mount to avoid server/client mismatch
  useEffect(() => {
    // CRITICAL: Sanitize storage BEFORE any React Query initialization
    // This prevents "Log In" placeholder data from being loaded
    sanitizeDormwayStorage();
    
    // Check specifically for dashboard-related React Query cache contamination
    // Only remove contaminated entries, not all cache
    if (typeof window !== 'undefined') {
      try {
        const storage = window.localStorage;
        let removedCount = 0;
        const keysToRemove: string[] = [];
        
        // Collect contaminated keys first (can't modify during iteration)
        for (let i = 0; i < storage.length; i++) {
          const key = storage.key(i);
          if (key && key.includes('react-query') && key.includes('dashboard')) {
            const value = storage.getItem(key);
            if (value && (value.toLowerCase().includes('"log in"') || value.toLowerCase().includes('dormway: log in'))) {
              keysToRemove.push(key);
            }
          }
        }
        
        // Remove contaminated keys
        for (const key of keysToRemove) {
          storage.removeItem(key);
          removedCount++;
        }
        
        if (removedCount > 0) {
          console.warn('[Storage] Removed', removedCount, '"Log In" contaminated dashboard cache entries');
        }
      } catch (e) {
        console.warn('[Storage] Failed to check React Query cache:', e);
      }
    }
    
    const prefs = readStoredPreferences();
    setTheme(prefs.theme);
    setFontSize(prefs.fontSize);
    setSidebarCollapsed(prefs.sidebarCollapsed);
    const currentTheme = prefs.theme === 'system' ? getSystemTheme() : prefs.theme;
    setResolvedTheme(currentTheme);
    applyTheme(currentTheme, prefs.fontSize);
  }, []);

  // Listen for system theme changes
  useEffect(() => {
    if (theme !== 'system') return;

    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

    const handleChange = () => {
      const newTheme = getSystemTheme();
      setResolvedTheme(newTheme);
      applyTheme(newTheme, fontSize);

      // Dispatch change event
      dispatchThemeChange({ theme, fontSize, sidebarCollapsed });
    };

    mediaQuery.addEventListener('change', handleChange);
    return () => mediaQuery.removeEventListener('change', handleChange);
  }, [theme, fontSize, sidebarCollapsed]);

  // Debounced backend persistence
  const debouncedSave = useCallback((updates: any) => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }

    saveTimeoutRef.current = setTimeout(async () => {
      try {
        setIsLoading(true);
        setError(null);
        await patchPreferences(updates);
      } catch (error) {
        setError('Failed to save preferences. Changes saved locally.');
        console.error('Failed to persist preference:', error);
      } finally {
        setIsLoading(false);
      }
    }, 500);
  }, []);

  // Enhanced update theme handler
  const updateTheme = useCallback(async (newTheme: ThemeMode) => {
    try {
      setTheme(newTheme);
      persistPreferences({ theme: newTheme });
      dispatchThemeChange({ theme: newTheme, fontSize, sidebarCollapsed });

      // Debounced backend save
      debouncedSave({ appBehavior: { theme: newTheme } });
    } catch (error) {
      setError('Failed to update theme');
      console.error('Theme update error:', error);
    }
  }, [fontSize, sidebarCollapsed, debouncedSave]);

  // Enhanced update font size handler
  const updateFontSize = useCallback(async (newSize: FontSizeOption) => {
    try {
      setFontSize(newSize);
      persistPreferences({ fontSize: newSize });
      dispatchThemeChange({ theme, fontSize: newSize, sidebarCollapsed });

      // Debounced backend save
      debouncedSave({ appBehavior: { fontSize: newSize } });
    } catch (error) {
      setError('Failed to update font size');
      console.error('Font size update error:', error);
    }
  }, [theme, sidebarCollapsed, debouncedSave]);

  // Enhanced update sidebar collapsed handler
  const updateSidebarCollapsed = useCallback(async (collapsed: boolean) => {
    try {
      setSidebarCollapsed(collapsed);
      persistPreferences({ sidebarCollapsed: collapsed });
      dispatchThemeChange({ theme, fontSize, sidebarCollapsed: collapsed });

      // Debounced backend save
      debouncedSave({ appBehavior: { sidebarCollapsed: collapsed } });
    } catch (error) {
      setError('Failed to update sidebar state');
      console.error('Sidebar update error:', error);
    }
  }, [theme, fontSize, debouncedSave]);

  // Cleanup timeout on unmount
  useEffect(() => {
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, []);

  // Memoize context value
  const contextValue = useMemo<ThemeContextType>(
    () => ({
      theme,
      resolvedTheme,
      fontSize,
      sidebarCollapsed,
      isLoading,
      error,
      updateTheme,
      updateFontSize,
      updateSidebarCollapsed,
    }),
    [theme, resolvedTheme, fontSize, sidebarCollapsed, isLoading, error, updateTheme, updateFontSize, updateSidebarCollapsed]
  );

  return <ThemeContext.Provider value={contextValue}>{children}</ThemeContext.Provider>;
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    // Return default theme values instead of throwing - safer for iframe/SSR edge cases
    console.warn('[useTheme] ThemeProvider not found, using default values');
    return {
      theme: 'dark' as ThemeMode,
      resolvedTheme: 'dark' as ResolvedThemeMode,
      fontSize: 'medium' as FontSizeOption,
      sidebarCollapsed: false,
      isLoading: false,
      error: null,
      updateTheme: async () => {},
      updateFontSize: async () => {},
      updateSidebarCollapsed: async () => {},
    };
  }
  return context;
}
```

### COMPLETE FILE 3: `src/components/Aurora.tsx`

```typescript
'use client';

import { useEffect, useRef, useState } from 'react';
import { Renderer, Program, Mesh, Color, Triangle } from 'ogl';

const VERT = `#version 300 es
in vec2 position;
void main() {
  gl_Position = vec4(position, 0.0, 1.0);
}
`;

const FRAG = `#version 300 es
precision highp float;

uniform float uTime;
uniform float uAmplitude;
uniform vec3 uColorStops[3];
uniform vec2 uResolution;
uniform float uBlend;

out vec4 fragColor;

vec3 permute(vec3 x) {
  return mod(((x * 34.0) + 1.0) * x, 289.0);
}

float snoise(vec2 v){
  const vec4 C = vec4(
      0.211324865405187, 0.366025403784439,
      -0.577350269189626, 0.024390243902439
  );
  vec2 i  = floor(v + dot(v, C.yy));
  vec2 x0 = v - i + dot(i, C.xx);
  vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;
  i = mod(i, 289.0);

  vec3 p = permute(
      permute(i.y + vec3(0.0, i1.y, 1.0))
    + i.x + vec3(0.0, i1.x, 1.0)
  );

  vec3 m = max(
      0.5 - vec3(
          dot(x0, x0),
          dot(x12.xy, x12.xy),
          dot(x12.zw, x12.zw)
      ),
      0.0
  );
  m = m * m;
  m = m * m;

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;
  m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);

  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}

struct ColorStop {
  vec3 color;
  float position;
};

#define COLOR_RAMP(colors, factor, finalColor) {              \
  int index = 0;                                            \
  for (int i = 0; i < 2; i++) {                               \
     ColorStop currentColor = colors[i];                    \
     bool isInBetween = currentColor.position <= factor;    \
     index = int(mix(float(index), float(i), float(isInBetween))); \
  }                                                         \
  ColorStop currentColor = colors[index];                   \
  ColorStop nextColor = colors[index + 1];                  \
  float range = nextColor.position - currentColor.position; \
  float lerpFactor = (factor - currentColor.position) / range; \
  finalColor = mix(currentColor.color, nextColor.color, lerpFactor); \
}

void main() {
  vec2 uv = gl_FragCoord.xy / uResolution;

  ColorStop colors[3];
  colors[0] = ColorStop(uColorStops[0], 0.0);
  colors[1] = ColorStop(uColorStops[1], 0.5);
  colors[2] = ColorStop(uColorStops[2], 1.0);

  vec3 rampColor;
  COLOR_RAMP(colors, uv.x, rampColor);

  float height = snoise(vec2(uv.x * 2.0 + uTime * 0.1, uTime * 0.25)) * 0.5 * uAmplitude;
  height = exp(height);
  height = (uv.y * 2.0 - height + 0.2);
  float intensity = 0.6 * height;

  float midPoint = 0.20;
  // Use blend factor to control edge smoothness - higher blend = smoother edges
  float auroraAlpha = smoothstep(midPoint - uBlend * 0.5, midPoint + uBlend * 0.5, intensity);
  // Keep smooth falloff - don't apply pow to avoid dark edges
  // The higher blend value (0.7) already provides smooth edges

  vec3 auroraColor = intensity * rampColor;
  // Boost color vibrancy - make colors brighter without muting
  auroraColor = mix(auroraColor, rampColor, 0.5);
  
  // Keep colors vibrant - output with alpha for proper transparency
  // Don't mix with white/black - let the page background show through transparent areas
  fragColor = vec4(auroraColor, auroraAlpha);
}
`;

interface AuroraProps {
  colorStops?: string[];
  amplitude?: number;
  blend?: number;
  time?: number;
  speed?: number;
  theme?: 'light' | 'dark' | 'glass';
}

export default function Aurora(props: AuroraProps) {
  const { colorStops = ['#6b21ff', '#ff5fa1', '#ff7b3f'], amplitude = 1.0, blend = 0.5, theme = 'dark' } = props;
  const propsRef = useRef<AuroraProps>(props);
  propsRef.current = props;

  const ctnDom = useRef<HTMLDivElement>(null);
  const rendererRef = useRef<Renderer | null>(null);
  const [webglAvailable, setWebglAvailable] = useState<boolean | null>(null);

  useEffect(() => {
    const ctn = ctnDom.current;
    if (!ctn) return;

    // Check if WebGL is available
    const canvas = document.createElement('canvas');
    let testGl: WebGLRenderingContext | WebGL2RenderingContext | null = null;
    try {
      testGl = canvas.getContext('webgl2') || canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    } catch (error) {
      console.warn('[Aurora] Error checking WebGL availability:', error);
    }
    
    if (!testGl) {
      // WebGL not available - use CSS fallback
      setWebglAvailable(false);
      console.warn('[Aurora] WebGL is not available, using CSS fallback. This could be due to:');
      console.warn('  - Hardware acceleration disabled');
      console.warn('  - Browser doesn\'t support WebGL');
      console.warn('  - GPU drivers outdated');
      console.warn('  - Too many WebGL contexts already created (browser limit ~16)');
      return;
    }
    
    setWebglAvailable(true);

    let renderer: Renderer | null = null;
    try {
      renderer = new Renderer({
        alpha: true,
        premultipliedAlpha: false, // Disable premultiplied alpha to avoid dark edges
        antialias: true
      });
      rendererRef.current = renderer;
    } catch (error) {
      console.warn('[Aurora] Failed to create WebGL renderer, using CSS fallback:', error);
      if (error instanceof Error) {
        console.warn('[Aurora] Error message:', error.message);
      }
      // Check if we've hit the WebGL context limit
      const contextCount = document.querySelectorAll('canvas').length;
      if (contextCount > 10) {
        console.warn(`[Aurora] Warning: ${contextCount} canvas elements found. Browser WebGL context limit may be reached.`);
      }
      setWebglAvailable(false);
      return;
    }

    if (!renderer || !renderer.gl) {
      console.warn('[Aurora] Renderer or GL context is null, using CSS fallback');
      setWebglAvailable(false);
      return;
    }

    const gl = renderer.gl;
    
    try {
      // Clear to transparent - adapts to page background (white in light, dark in dark mode)
      gl.clearColor(0, 0, 0, 0);
      gl.enable(gl.BLEND);
      // Use standard alpha blending - transparent areas show page background
      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
      gl.canvas.style.backgroundColor = 'transparent';

      let program: Program | undefined;

      function resize() {
        if (!ctn || !renderer) return;
        const width = ctn.offsetWidth;
        const height = ctn.offsetHeight;
        renderer.setSize(width, height);
        if (program) {
          program.uniforms.uResolution.value = [width, height];
        }
      }
      window.addEventListener('resize', resize);

      const geometry = new Triangle(gl);
      if (geometry.attributes.uv) {
        delete geometry.attributes.uv;
      }

      const colorStopsArray = colorStops.map(hex => {
        const c = new Color(hex);
        return [c.r, c.g, c.b];
      });

      program = new Program(gl, {
        vertex: VERT,
        fragment: FRAG,
        uniforms: {
          uTime: { value: 0 },
          uAmplitude: { value: amplitude },
          uColorStops: { value: colorStopsArray },
          uResolution: { value: [ctn.offsetWidth, ctn.offsetHeight] },
          uBlend: { value: blend }
        }
      });

      const mesh = new Mesh(gl, { geometry, program });
      ctn.appendChild(gl.canvas);

      let animateId = 0;
      const update = (t: number) => {
        if (!renderer || !program) return;
        animateId = requestAnimationFrame(update);
        const { time = t * 0.01, speed = 1.0 } = propsRef.current;
        program.uniforms.uTime.value = time * speed * 0.1;
        program.uniforms.uAmplitude.value = propsRef.current.amplitude ?? 1.0;
        program.uniforms.uBlend.value = propsRef.current.blend ?? 0.5;
        const stops = propsRef.current.colorStops ?? ['#6b21ff', '#ff5fa1', '#ff7b3f'];
        program.uniforms.uColorStops.value = stops.map((hex: string) => {
          const c = new Color(hex);
          return [c.r, c.g, c.b];
        });
        renderer.render({ scene: mesh });
      };
      animateId = requestAnimationFrame(update);

      resize();

      return () => {
        cancelAnimationFrame(animateId);
        window.removeEventListener('resize', resize);
        if (ctn && gl.canvas.parentNode === ctn) {
          ctn.removeChild(gl.canvas);
        }
        // Properly dispose of WebGL context
        try {
          if (gl.getExtension('WEBGL_lose_context')) {
            gl.getExtension('WEBGL_lose_context')?.loseContext();
          }
        } catch (error) {
          // Ignore cleanup errors
        }
        rendererRef.current = null;
      };
    } catch (error) {
      console.warn('[Aurora] Error initializing WebGL, using CSS fallback:', error);
      rendererRef.current = null;
      setWebglAvailable(false);
      return;
    }
  }, []); // Only run once on mount

  // CSS fallback for when WebGL is not available
  const getCssFallback = () => {
    if (webglAvailable === false) {
      // Parse color stops to RGB values for CSS gradients
      const colors = colorStops.map(hex => {
        // Convert hex to rgba
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, 0.3)`;
      });

      return (
        <div className="absolute inset-0 w-full h-full overflow-hidden">
          {/* Animated gradient orbs - similar to Aurora effect */}
          <div
            className="absolute -top-20 -right-20 h-64 w-64 sm:h-80 sm:w-80 rounded-full blur-[80px] sm:blur-[100px] animate-pulse"
            style={{
              background: `radial-gradient(circle, ${colors[0]} 0%, transparent 70%)`,
              animation: 'aurora-float 8s ease-in-out infinite',
            }}
          />
          <div
            className="absolute -bottom-24 -left-24 h-64 w-64 sm:h-80 sm:w-80 rounded-full blur-[80px] sm:blur-[100px] animate-pulse"
            style={{
              background: `radial-gradient(circle, ${colors[1]} 0%, transparent 70%)`,
              animation: 'aurora-float 10s ease-in-out infinite 2s',
            }}
          />
          <div
            className="absolute bottom-0 left-1/2 -translate-x-1/2 h-40 w-40 sm:h-64 sm:w-64 rounded-full blur-[70px] sm:blur-[90px] animate-pulse"
            style={{
              background: `radial-gradient(circle, ${colors[2] || colors[0]} 0%, transparent 70%)`,
              animation: 'aurora-float 12s ease-in-out infinite 4s',
            }}
          />
          <style dangerouslySetInnerHTML={{
            __html: `
              @keyframes aurora-float {
                0%, 100% {
                  transform: translate(0, 0) scale(1);
                  opacity: 0.6;
                }
                33% {
                  transform: translate(20px, -30px) scale(1.1);
                  opacity: 0.8;
                }
                66% {
                  transform: translate(-20px, 20px) scale(0.9);
                  opacity: 0.7;
                }
              }
            `
          }} />
        </div>
      );
    }
    return null;
  };

  return (
    <div ref={ctnDom} className="w-full h-full relative">
      {webglAvailable === false && getCssFallback()}
    </div>
  );
}
```

### COMPLETE FILE 4: `src/components/NavBar.tsx` - Key Sections

[See full file content above - 1043 lines - includes landing page styling, theme dropdown, and conditional text styling based on `isLandingPage` and `resolvedTheme`]

**Key NavBar Sections for Landing Page:**
- Lines 238-246: `navShellClasses` - Landing page background styling
- Lines 300-320: Logo text styling with `text-shadow` for landing page
- Lines 311-319: BETA badge styling for landing page
- Lines 361-410: Navigation links (Blog, Roadmap, About, Careers) with landing page conditional styling
- Lines 415-453: Theme dropdown with `w-36` width

### COMPLETE FILE 5: `src/app/page.tsx` - Critical Hero Section (Lines 1147-1298)

[See hero section above - includes Aurora rendering, main headline with `text-[var(--ds-hero-cta-fg)]`, problem statement, subheadline, and proof chips]

**Critical Sections:**
- Lines 1150-1158: Aurora conditional rendering based on `resolvedTheme`
- Lines 1218-1228: Main headline (`Never wonder what's due.`) with `text-[var(--ds-hero-cta-fg)]` and `text-shadow`
- Lines 1231-1234: Subheadline with `text-shadow` for readability
- Lines 1237-1257: Proof chips with theme-aware styling

**Note:** The full `page.tsx` file is 2767 lines. The hero section (lines 1147-1298) is the most critical for the current issues. Other sections include content sections that were made transparent to allow Aurora to show through.

---

**Please provide a comprehensive analysis, specific fixes, and a clear implementation plan. Don't assume anything - check all files and reason through the entire theme system architecture.**
