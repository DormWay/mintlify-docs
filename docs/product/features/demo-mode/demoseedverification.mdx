---
title: "DEMO_SEED_VERIFICATION"
description: "The script is verified and ready to run with the following steps:"
---

# Demo Data Seeding Script - Verification Summary

## ‚úÖ Verified Against Codebase

### 1. **Database Schema Verification**

#### ‚úÖ `accounts` Table (not `users`)
- **Fixed**: Changed from `users` to `accounts` table
- **Query**: `SELECT id, email FROM accounts WHERE LOWER(email) = LOWER($1)`
- **Verified**: Matches patterns in `aurora-client.ts` and `user-campus-resolver.ts`

#### ‚úÖ `contexts` Table
- **Columns Used**: `id`, `user_id`, `parent_id`, `type`, `name`, `metadata`, `created_at`, `updated_at`
- **Verified**: Matches pattern in `onboarding-v2.ts` (line 191)
- **Structure**: Correct hierarchical structure (student ‚Üí courses)

#### ‚úÖ `service_data` Table
- **Columns Used**: `id`, `user_id`, `context_id`, `method`, `fetched_at`, `data`, `created_at`, `updated_at`
- **Verified**: Matches schema from `WIDGET_API_GUIDE.md` (lines 585-595)
- **ON CONFLICT**: Uses `ON CONFLICT (id) DO NOTHING` (id is PRIMARY KEY)
- **Data Format**: JSONB for `data` column - correctly stringified

#### ‚úÖ `tasks` Table
- **Columns Used**: `id`, `user_id`, `title`, `priority`, `estimated_duration_minutes`, `due_date`, `status`, `course_code`, `source`, `created_at`, `updated_at`
- **Verified**: Matches schema from `20251009_add_tasks_table.sql`
- **Key Fixes**:
  - ‚úÖ `estimated_duration_minutes` (not `estimated_duration`)
  - ‚úÖ `source` column required with CHECK constraint ('manual', 'assignment', 'dayplan', 'ai_suggestion')
  - ‚úÖ `user_id` references `accounts(id)` (verified in migration)
- **ON CONFLICT**: Uses `ON CONFLICT (id) DO NOTHING`

### 2. **Data Structure Verification**

#### ‚úÖ Context Hierarchy
- **Student Context**: Created with `type='student'`, `user_id` set
- **Course Contexts**: Created with `type='course'`, `parent_id` pointing to student context
- **Verified**: Matches pattern from `WIDGET_API_GUIDE.md` (lines 639-658)

#### ‚úÖ Service Data Format
- **Assignments**: `method='assignment'`, data includes `title`, `courseCode`, `dueDate`, `priority`, `estimatedDuration`, `status`, `source`
- **Calendar Events**: `method='calendar'`, data includes `summary`, `start`, `end`, `location`, `eventType`, `courseCode`
- **Verified**: Matches patterns from `WIDGET_API_GUIDE.md` (lines 598-612)

#### ‚úÖ Task Format
- **Required Fields**: `title`, `priority`, `estimated_duration_minutes`, `status`, `source`
- **Optional Fields**: `course_code`, `due_date`, `metadata`
- **Verified**: Matches pattern from `task-routes.ts` (lines 74-94)

### 3. **Date Handling**

#### ‚úÖ Relative Dates
- Uses `getDateOffset(days)` helper function
- All dates calculated relative to "today"
- **Verified**: Ensures realistic preview that stays current

#### ‚úÖ ISO String Format
- Uses `toISOString()` for all timestamps
- **Verified**: Matches database `timestamptz` format requirements

### 4. **Dependencies**

#### ‚úÖ Imports
- `auroraClient` from `../services/aurora-client` ‚úÖ
- `createLogger` from `../utils/logger` ‚úÖ
- `uuid` v4 from `uuid` package ‚úÖ
- **Note**: May need to install `uuid` and `@types/uuid` if not already present

### 5. **Error Handling**

#### ‚úÖ User Lookup
- Checks if demo user exists before proceeding
- Throws clear error message if user not found
- **Verified**: Prevents silent failures

#### ‚úÖ Conflict Handling
- Uses `ON CONFLICT DO NOTHING` for idempotent runs
- **Verified**: Safe to run multiple times

### 6. **Mock Data Completeness**

#### ‚úÖ Courses (5 courses)
- ECON 301, CS 201, HIST 150, MATH 225, PSYC 101
- Includes metadata: name, instructor, credits, workload, color

#### ‚úÖ Assignments (7 total)
- **Do Now**: 2 assignments (due 1-2 days)
- **Up Next**: 3 assignments (due 3-7 days)
- **Due Soon**: 2 assignments (due 8-14 days)

#### ‚úÖ Schedule Events
- Recurring classes for 4 weeks (MWF, TTH, MW patterns)
- One-time events (midterm, office hours)

#### ‚úÖ Tasks (3 tasks)
- Various priorities (medium, high, urgent)
- Linked to courses

## ‚ö†Ô∏è Potential Issues & Recommendations

### 1. **Service Data Partitioning**
- `service_data` is partitioned by month
- **Recommendation**: Ensure `fetched_at` dates are within current month partition
- **Status**: ‚úÖ Script uses current date for `fetched_at`

### 2. **RLS (Row Level Security)**
- `tasks` table has RLS enabled
- **Potential Issue**: Script may need to run as admin or with RLS bypass
- **Recommendation**: Test in development first, may need admin role

### 3. **Context Metadata**
- Course metadata stored as JSONB
- **Verified**: ‚úÖ Correctly stringified with `JSON.stringify()`

### 4. **Missing Features**
- **Notes**: Not yet implemented in script (can be added later)
- **Ace Insights**: Not yet implemented (would require additional service_data entries)
- **Workload Scores**: Not yet implemented (would require calculation logic)

## ‚úÖ Ready to Run

The script is verified and ready to run with the following steps:

1. **Install Dependencies** (if needed):
   ```bash
   cd services/api-router
   npm install uuid @types/uuid
   ```

2. **Verify Demo User Exists**:
   - Ensure `demo@dormway.app` exists in Clerk
   - Ensure corresponding record exists in `accounts` table

3. **Run Script**:
   ```bash
   cd services/api-router
   npx ts-node src/scripts/seed-demo-data.ts
   ```

4. **Verify Results**:
   - Check that contexts were created
   - Check that service_data entries exist
   - Check that tasks were created
   - Test demo mode in landing page

## üìù Next Steps (Optional Enhancements)

1. Add notes seeding
2. Add Ace insights via service_data
3. Add workload score calculation
4. Add periodic refresh mechanism
5. Add admin endpoint to trigger refresh
