---
title: "Material Gaps Analysis   Sep 2025"
description: "This document provides a comprehensive analysis of material gaps in the DormWay platform based on the 5 Core User Journeys. Critical gaps have been identifie..."
---

# Material Gaps Analysis - September 2025
#gap-analysis #journey-mapping #technical-debt

## Executive Summary

This document provides a comprehensive analysis of material gaps in the DormWay platform based on the 5 Core User Journeys. Critical gaps have been identified in geospatial search, onboarding flows, schedule ingestion, and real-time features.

## Journey 1: First-Time Onboarding

### Current State
- âœ… Campus detection via coordinates (`/api/mobile/detect-campus`)
- âœ… Profile creation and update endpoints
- âœ… Building context creation
- âœ… Workflow: `campusOnboarding.workflow.ts`

### **CRITICAL GAPS**
1. **ðŸ”´ No Geosearch Endpoint** - Users cannot search for campuses by location/name
2. **ðŸ”´ No Onboarding Progress Tracking** - No way to track/resume incomplete onboarding
3. **ðŸŸ¡ Missing Batch Campus Search** - Can't show nearby campuses for selection
4. **ðŸŸ¡ No Major/Minor Validation** - Static data exists but no validation endpoint
5. **ðŸŸ¡ No Housing Recommendation Engine** - Building contexts exist but no recommendations

### Required Endpoints
```typescript
// PRIORITY 1: Add to campus-routes.ts
POST /api/campus/geosearch
{
  latitude?: number,
  longitude?: number,
  searchTerm?: string,
  radius?: number // km
}

// PRIORITY 2: Onboarding state
POST /api/mobile/onboarding/state
GET /api/mobile/onboarding/progress

// PRIORITY 3: Academic validation
POST /api/mobile/validate-major
GET /api/campus/:id/available-majors
```

## Journey 2: Syllabus Upload

### Current State
- âœ… Webhook ingestion (`/webhooks/v1/postmark`)
- âœ… Manual upload endpoint (`/api/syllabus/upload`)
- âœ… Workflow: `syllabusProcessor.workflow.ts`
- âœ… S3 presigned URLs (6-hour expiry)
- âœ… Campus detection from email domains

### **GAPS**
1. **ðŸ”´ No Upload Status Tracking** - Users can't see processing status
2. **ðŸŸ¡ No Bulk Upload Support** - One syllabus at a time
3. **ðŸŸ¡ Missing Error Recovery UI** - Failed uploads have no retry mechanism
4. **ðŸŸ¡ No Manual Course Entry** - If parsing fails, no fallback

### Required Endpoints
```typescript
// PRIORITY 1: Status tracking
GET /api/mobile/syllabus/status/:uploadId
GET /api/mobile/courses/pending

// PRIORITY 2: Manual fallback
POST /api/mobile/courses/manual
{
  courseName: string,
  courseCode: string,
  instructor: string,
  schedule: {...}
}

// PRIORITY 3: Bulk operations
POST /api/mobile/syllabus/bulk-upload
DELETE /api/mobile/courses/:courseId
```

## Journey 3: Calendar Connection

### Current State
- âœ… Google Calendar connect/disconnect
- âœ… ICS file support (`/api/mobile/claim-ics`)
- âœ… Calendar preferences CRUD
- âœ… Upcoming events endpoint
- âœ… **Apple Calendar READ Access** - EventKit reads calendar data in iOS
- âœ… **Schedule Reconciliation** - `scheduleProcessor` merges multiple calendar sources
- âœ… **Same-Course Overlap Merging** - Combines overlapping events from same course
- âœ… **AI Conflict Analysis** - Semester-level conflict detection (not real-time)

### **CRITICAL GAPS**
1. **ðŸ”´ No Apple Calendar WRITE Access** - Can't add events to iOS calendars
2. **ðŸ”´ Missing Outlook/Exchange Support** - Many universities use Exchange
3. **ðŸ”´ No Real-Time Conflict Prevention** - Conflicts detected after the fact, not prevented
4. **ðŸŸ¡ No Cross-Course Conflict Detection** - Only merges same-course overlaps
5. **ðŸŸ¡ No Conflict Resolution UI** - Detects but doesn't help resolve
6. **ðŸŸ¡ Missing Calendar Sync Status** - No way to see last sync time

### Implementation Details
The system has a `scheduleProcessor` workflow that:
- Fetches from 6 calendar sources (Google, LMS, Atlas, Mobile, Syllabus, Course Events)
- Normalizes and consolidates all events
- Merges overlapping events ONLY if from the same course
- Uses AI for semester-level conflict analysis (not real-time)

### Required Enhancements
```typescript
// PRIORITY 1: Real-time conflict detection
POST /api/mobile/calendar/check-conflicts
{
  newEvent: CalendarEvent,
  existingEvents?: CalendarEvent[]
}

// PRIORITY 2: Conflict resolution UI
GET /api/mobile/calendar/conflicts/:userId
POST /api/mobile/calendar/resolve-conflict

// PRIORITY 3: Cross-course conflict detection
// Modify mergeOverlappingEvents() to:
- Detect conflicts between different courses
- Return conflict metadata for UI display
- Suggest resolution options
```

## Journey 4: First BrainGains Use

### Current State
- âœ… Chat endpoint (`/api/braingains/chat`)
- âœ… Session management
- âœ… Context retrieval
- âœ… Workflow: `brainGainsProcessor.workflow.ts`

### **GAPS**
1. **ðŸ”´ No Context Warmup** - First query slow due to context loading
2. **ðŸ”´ Missing Feedback Loop** - No way to rate/improve responses
3. **ðŸŸ¡ No Suggested Prompts** - Users don't know what to ask
4. **ðŸŸ¡ Missing Study Mode Toggle** - Can't switch between modes
5. **ðŸŸ¡ No Response History Export** - Can't save useful responses

### Required Endpoints
```typescript
// PRIORITY 1: Context optimization
POST /api/braingains/warmup
GET /api/braingains/suggested-prompts

// PRIORITY 2: Feedback system
POST /api/braingains/feedback/:messageId
{
  helpful: boolean,
  feedback?: string
}

// PRIORITY 3: Study modes
POST /api/braingains/mode
GET /api/braingains/history/export
```

## Journey 5: Daily Return User

### Current State
- âœ… Dashboard BFF (`/dashboard/v1/composite`)
- âœ… DayPlan endpoint (`/api/mobile/dayplan`)
- âœ… Notifications list
- âŒ No real widgets system

### **CRITICAL GAPS**
1. **ðŸ”´ No Widget Configuration API** - Can't customize home screen
2. **ðŸ”´ Missing Push Notification Triggers** - No proactive engagement
3. **ðŸ”´ No Quick Actions API** - Common tasks require multiple taps
4. **ðŸŸ¡ Missing Streak Tracking** - No engagement metrics
5. **ðŸŸ¡ No Personalization Engine** - Same experience for all users

### Required Systems
```typescript
// NEW ENDPOINTS NEEDED
POST /api/mobile/widgets/configure
GET /api/mobile/widgets/data/:widgetType
POST /api/mobile/quick-actions/:action

// NEW WORKFLOW NEEDED
dailyDigest.workflow.ts
widgetDataRefresh.workflow.ts
engagementTracking.workflow.ts
```

## Infrastructure Gaps

### Database Schema Gaps
1. **ðŸ”´ No `user_onboarding_state` table** - Can't track progress
2. **ðŸ”´ No `widget_configurations` table** - Can't save preferences  
3. **ðŸ”´ No `user_engagement_metrics` table** - Can't measure retention
4. **ðŸŸ¡ Missing indexes on `user_locations` for geo queries**
5. **ðŸŸ¡ No `calendar_sync_status` table** - Can't track sync health

### Temporal Workflow Gaps
1. **ðŸ”´ No `userOnboarding` workflow** - State machine needed
2. **ðŸ”´ No `dailyDigest` workflow** - For morning notifications
3. **ðŸ”´ No `widgetRefresh` workflow** - For real-time widget data
4. **ðŸŸ¡ Missing retry logic in `syllabusProcessor`**
5. **ðŸŸ¡ No dead letter queue for failed workflows**

### Monitoring & Analytics Gaps
1. **ðŸ”´ No journey funnel tracking**
2. **ðŸ”´ No A/B testing framework**
3. **ðŸ”´ Missing error tracking for mobile clients**
4. **ðŸŸ¡ No performance metrics per journey**
5. **ðŸŸ¡ No user satisfaction metrics**

## Priority Matrix

### P0 - Ship Blockers (Do Now)
1. **Add Geosearch Endpoint** - Journey 1 blocked
   ```typescript
   // campus-routes.ts
   router.post('/geosearch', async (req, res) => {
     const { latitude, longitude, searchTerm, radius = 10 } = req.body;
     // Use PostGIS ST_DWithin for radius search
     // Text search on campus names
   })
   ```

2. **Create Onboarding State Machine** - Users get lost
   ```sql
   CREATE TABLE user_onboarding_state (
     user_id UUID PRIMARY KEY,
     current_step VARCHAR(50),
     completed_steps JSONB,
     metadata JSONB,
     updated_at TIMESTAMP DEFAULT NOW()
   );
   ```

3. **Add Upload Status Tracking** - Users abandon
   ```typescript
   // New workflow signal
   syllabusProcessor.defineSignal('getStatus')
   ```

### P1 - Core Experience (This Sprint)  
1. Outlook Calendar Integration
2. Widget Configuration API
3. BrainGains Feedback Loop
4. Push Notification Triggers
5. Manual Course Entry

### P2 - Enhancement (Next Sprint)
1. Bulk Syllabus Upload
2. Study Mode Toggle
3. Engagement Metrics
4. Quick Actions API
5. Calendar Sync Status Dashboard

### P3 - Nice to Have (Backlog)
1. Housing Recommendations
2. Conflict Resolution UI
3. Response Export
4. A/B Testing
5. Satisfaction Surveys

## Implementation Recommendations

### Immediate Actions (Week 1)
1. **Geosearch Endpoint**: 
   - Add to `campus-routes.ts`
   - Use existing PostGIS functions
   - 4 hours estimated

2. **Onboarding State**:
   - Create migration 049
   - Add state machine workflow
   - 8 hours estimated

3. **Upload Status**:
   - Add status to syllabus workflow
   - Create status endpoint
   - 6 hours estimated

### Sprint 1 (Weeks 2-3)
- Outlook Calendar Integration (3 days)
- Widget System MVP (5 days)
- BrainGains Improvements (2 days)

### Sprint 2 (Weeks 4-5)
- Push Notifications (3 days)
- Manual Course Entry (2 days)
- Engagement Tracking (3 days)
- Performance Optimizations (2 days)

## Success Metrics

### Journey Completion Rates (Target)
- Journey 1: 80% complete onboarding
- Journey 2: 60% upload syllabus
- Journey 3: 50% connect calendar
- Journey 4: 70% try BrainGains
- Journey 5: 40% DAU/MAU ratio

### Technical Metrics
- API response time < 200ms (p95)
- Workflow success rate > 95%
- Zero data loss incidents
- Mobile crash rate < 0.5%

## Risk Mitigation

### High Risk Items
1. **PostGIS Performance**: Add spatial indexes before geosearch
2. **Calendar API Limits**: Implement rate limiting and caching
3. **Widget Data Freshness**: Use Ably for real-time updates
4. **Workflow Failures**: Add comprehensive retry logic

### Mitigation Strategy
1. Load test geosearch with 10k concurrent users
2. Implement circuit breakers for external APIs  
3. Add monitoring for each journey funnel
4. Create fallback paths for all critical flows

## Conclusion

The platform has strong foundations but lacks critical user-facing features for a smooth journey experience. The highest priority is adding geospatial search and onboarding state management. 

### Key Findings from Code Analysis
1. **Schedule reconciliation exists** but only merges multiple calendar sources, not conflict detection
2. **Conflict detection is AI-based** at semester level, not real-time or preventive
3. **Apple Calendar integration is READ-ONLY** - can't write events back
4. **Same-course overlaps are merged** but cross-course conflicts are ignored

### Critical Recommendations
1. **Implement real-time conflict checking** - Before users add events, check for conflicts
2. **Add Apple Calendar WRITE access** - Complete the bidirectional sync
3. **Create conflict resolution UI** - Help users resolve detected conflicts
4. **Extend mergeOverlappingEvents()** - Detect cross-course conflicts, not just same-course
5. **Add geosearch endpoint immediately** - This is blocking onboarding

### Next Steps
1. Review with product team
2. Create Linear issues for P0/P1 items
3. Update technical roadmap
4. Begin geosearch implementation
5. Implement real-time conflict detection API

---

*Document created: September 4, 2025*
*Author: System Analysis*
*Status: REQUIRES REVIEW*
