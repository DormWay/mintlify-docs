---
title: "Weather Freshness"
description: "Weather data is composed from city-level processed payloads stored in `service_data` with `method = 'processed_city_weather_context'`. The dashboard composes..."
---

# Weather Freshness

## Overview

Weather data is composed from city-level processed payloads stored in `service_data` with `method = 'processed_city_weather_context'`. The dashboard composes campus weather by resolving campus → city and reading the most recent processed entry.

## Manual Refresh (Admin)

Endpoint:

- `POST /dashboard/admin/refresh-city-weather/:cityId`
  - Optional: `?lat={latitude}&lon={longitude}`
  - Requires: `OPENWEATHER_API_KEY` (Doppler)

Response includes the processed payload written to `service_data`.

## Local Debug

- `GET /dashboard/campus-weather/:campusId?processed=true` — Returns current processed weather for the campus’s city.
- `GET /dashboard/debug/weather/:cityId` — Compares raw vs processed payloads for QA.

## Scheduling (Recommended)

For beta and beyond, schedule a daily refresh for pilot campuses:

- Cadence: daily at ~04:00 local campus time
- Mechanism: Temporal workflow or cron-style task calling the admin refresh endpoint for each campus city
- Failure handling: retry with backoff; alert on 3 consecutive failures

## Local Dev

Use the idempotent seed to bootstrap Ann Arbor (UMich) with processed weather:

```
make dev          # seeds accounts, user context, city/campus, and weather
make smoke-weather
```
