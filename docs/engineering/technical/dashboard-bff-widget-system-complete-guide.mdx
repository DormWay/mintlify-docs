---
title: "Dashboard BFF Widget System   Complete Guide"
description: "This guide explains **how the home page gets populated with real data** from the backend using the **Widget Envelope Strategy** and `service_data` table. Thi..."
---

# Dashboard BFF Widget System - Complete Data Integration Guide

## Overview

This guide explains **how the home page gets populated with real data** from the backend using the **Widget Envelope Strategy** and `service_data` table. This is your definitive guide to understanding the full data flow from database ‚Üí API ‚Üí Frontend.

---

## üéØ The Widget Envelope Strategy (Core Concept)

### What Is A Widget Envelope?

A **Widget Envelope** is a standardized container that wraps different types of dashboard data (weather, schedule, assignments, etc.) in a consistent structure:

```typescript
interface WidgetEnvelope {
  id: string;                    // Stable, deterministic ID (e.g., "widget:weather")
  type: string;                  // Widget type (e.g., "weather", "schedule", "academic")
  title?: string;                // Display title
  priority?: number;             // Rendering priority
  content: {
    displayType?: string;        // How to render (e.g., "timeline", "urgent_deadlines")
    data: any;                   // The actual widget data
  };
  grid?: {                       // Optional grid layout hints
    w?: number; h?: number;
    minW?: number; minH?: number;
  };
}
```

### Why Widget Envelopes?

1. **Consistent API Contract** - Frontend always expects `widgets[]` array
2. **Type Safety** - Each widget type has known data schema
3. **Easy Extension** - Add new widget types without breaking existing code
4. **Real-time Updates** - Ably deltas use widget IDs for surgical updates
5. **Caching** - ETag based on widget array for efficient 304 responses

---

## üìä Data Flow Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. DATA SOURCES (Multiple Origins)                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Temporal     ‚îÇ  ‚îÇ External     ‚îÇ  ‚îÇ User Input   ‚îÇ  ‚îÇ AI Crews  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Workflows    ‚îÇ  ‚îÇ APIs         ‚îÇ  ‚îÇ (Manual)     ‚îÇ  ‚îÇ (BrainGa  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ ins)      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ          ‚îÇ                 ‚îÇ                 ‚îÇ                ‚îÇ       ‚îÇ
‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                    ‚îÇ                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. STORAGE (service_data table - Partitioned by Month)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Table: service_data (partitioned by fetched_at)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ user_id      ‚îÇ method       ‚îÇ data (JSONB) ‚îÇ fetched_at         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ (UUID)       ‚îÇ (TEXT)       ‚îÇ              ‚îÇ (TIMESTAMP)        ‚îÇ   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ
‚îÇ  ‚îÇ user-123     ‚îÇ weather      ‚îÇ {...}        ‚îÇ 2025-10-09 04:00   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ user-123     ‚îÇ schedule     ‚îÇ {...}        ‚îÇ 2025-10-09 04:00   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ user-123     ‚îÇ dayplan      ‚îÇ {blocks:[]}  ‚îÇ 2025-10-09 03:30   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ user-123     ‚îÇ assignments  ‚îÇ {...}        ‚îÇ 2025-10-09 03:00   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Common `method` values:                                                ‚îÇ
‚îÇ  - weather                  - Weather data from external API           ‚îÇ
‚îÇ  - schedule                 - Calendar events                          ‚îÇ
‚îÇ  - dayplan                  - AI-generated daily plan                  ‚îÇ
‚îÇ  - assignments              - Canvas assignments                       ‚îÇ
‚îÇ  - parking                  - Campus parking availability              ‚îÇ
‚îÇ  - dining                   - Dining hall hours/menus                  ‚îÇ
‚îÇ  - braingains_*             - BrainGains processed syllabus insights   ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. BFF TRANSFORMATION (Dashboard Composite Transformer)                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  File: services/api-router/src/services/                               ‚îÇ
‚îÇ        dashboard-composite-transformer.ts                               ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Function: transformToDashboardCompositeV1()                            ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Process:                                                               ‚îÇ
‚îÇ  1. Fetch all service_data for user                                    ‚îÇ
‚îÇ  2. Group by method (weather, schedule, etc.)                          ‚îÇ
‚îÇ  3. Transform each into WidgetEnvelope                                 ‚îÇ
‚îÇ  4. Apply runtime guards (validate data shape)                         ‚îÇ
‚îÇ  5. Compute canonical ETag (SHA-256 of widget array)                   ‚îÇ
‚îÇ  6. Cache in Redis with context-aware TTL                              ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Example Transformation:                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ service_data.method = "weather"                                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ service_data.data = {                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   "temp": 72, "condition": "sunny", "humidity": 45           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ }                                                              ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                          ‚îÇ                                              ‚îÇ
‚îÇ                          ‚ñº Transform                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ WidgetEnvelope {                                               ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   id: "widget:weather",                                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   type: "weather",                                             ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   content: {                                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ     displayType: "current",                                    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ     data: {                                                    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ       status: "available",                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ       current: {                                               ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ         temperature: 72,                                       ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ         condition: "sunny",                                    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ         humidity: 45                                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ       }                                                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ     }                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   }                                                            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ }                                                              ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. API RESPONSE (BFF v1 Endpoint)                                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Endpoint: GET /dashboard/v1/composite?tab=home&context=campus         ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Response Structure:                                                    ‚îÇ
‚îÇ  {                                                                      ‚îÇ
‚îÇ    "version": "1.0",                                                    ‚îÇ
‚îÇ    "server_time": "2025-10-09T08:30:00.000Z",                          ‚îÇ
‚îÇ    "request": {                                                         ‚îÇ
‚îÇ      "tab": "home",                                                     ‚îÇ
‚îÇ      "context": "campus",                                               ‚îÇ
‚îÇ      "generatedAt": "2025-10-09T08:30:00.000Z"                          ‚îÇ
‚îÇ    },                                                                   ‚îÇ
‚îÇ    "widgets": [                                                         ‚îÇ
‚îÇ      { id: "widget:weather", type: "weather", ... },                   ‚îÇ
‚îÇ      { id: "widget:schedule", type: "schedule", ... },                 ‚îÇ
‚îÇ      { id: "widget:academic", type: "academic", ... },                 ‚îÇ
‚îÇ      { id: "widget:dayplan", type: "dayplan", ... }                    ‚îÇ
‚îÇ    ],                                                                   ‚îÇ
‚îÇ    "status": {                                                          ‚îÇ
‚îÇ      "calendar_connected": true,                                        ‚îÇ
‚îÇ      "syllabus_count": 5,                                               ‚îÇ
‚îÇ      "last_ingest_at": "2025-10-08T10:00:00.000Z"                       ‚îÇ
‚îÇ    },                                                                   ‚îÇ
‚îÇ    "metadata": {                                                        ‚îÇ
‚îÇ      "requestId": "req-123",                                            ‚îÇ
‚îÇ      "processingTimeMs": 45,                                            ‚îÇ
‚îÇ      "cache": { "hit": true, "ttl": 300 }                               ‚îÇ
‚îÇ    }                                                                    ‚îÇ
‚îÇ  }                                                                      ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Headers:                                                               ‚îÇ
‚îÇ  - ETag: W/"dcv1-abc123..."                                             ‚îÇ
‚îÇ  - Cache-Control: private, no-cache                                     ‚îÇ
‚îÇ  - Vary: Authorization                                                  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. FRONTEND CONSUMPTION (React Query + Hooks)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Hook: useDashboardComposite()                                          ‚îÇ
‚îÇ  File: src/hooks/home/useDashboardComposite.ts                          ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Features:                                                              ‚îÇ
‚îÇ  - ETag caching (98% bandwidth savings on cache hits)                  ‚îÇ
‚îÇ  - 304 Not Modified support                                             ‚îÇ
‚îÇ  - Automatic retry on failure                                           ‚îÇ
‚îÇ  - Widget envelope transformation                                       ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Usage in Components:                                                   ‚îÇ
‚îÇ  ```typescript                                                          ‚îÇ
‚îÇ  const { data, isLoading } = useDashboardComposite({                   ‚îÇ
‚îÇ    tab: 'home',                                                         ‚îÇ
‚îÇ    context: 'campus'                                                    ‚îÇ
‚îÇ  });                                                                    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  // Access transformed data                                             ‚îÇ
‚îÇ  const events = data?.timeline.events;      // TimeBlock[]             ‚îÇ
‚îÇ  const tasks = data?.unscheduledTasks;      // UnscheduledTask[]       ‚îÇ
‚îÇ  const assignments = data?.dueSoon;         // DueItem[]               ‚îÇ
‚îÇ  const notes = data?.recentNotes;           // RecentNote[]            ‚îÇ
‚îÇ  const rawWidgets = data?.widgets;          // WidgetEnvelope[]        ‚îÇ
‚îÇ  ```                                                                    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß How Each Component Gets Data

### 1. Timeline / DayStrip

**Data Source:** `widgets[]` with `type: "schedule"`

**Backend Transformation:**
```typescript
// service_data.method = "schedule"
// service_data.data = { events: [...] }

// Transformed to:
{
  id: "widget:schedule",
  type: "schedule",
  content: {
    displayType: "timeline",
    data: {
      items: [
        {
          id: "event-123",
          title: "EECS 281 Lecture",
          startTime: "2025-10-09T10:00:00Z",
          endTime: "2025-10-09T11:30:00Z",
          location: "2505 GGBL",
          courseCode: "EECS 281"
        }
      ]
    }
  }
}
```

**Frontend Extraction** (from `useDashboardComposite.ts:272-304`):
```typescript
const timelineWidget = widgets.find(w =>
  w.type === 'schedule' && w.content?.displayType === 'timeline'
);
const timelineItems = timelineWidget?.content?.data?.items || [];

const events: TimeBlock[] = timelineItems.map(item => ({
  id: item.id,
  title: item.title,
  start: item.startTime,
  end: item.endTime,
  type: 'class',
  courseCode: item.courseCode,
  location: item.location
}));
```

### 2. Task Bank

**Data Source:** `widgets[]` with `type: "dayplan"` + persistent `tasks` table

**Backend Transformation:**
```typescript
// service_data.method = "dayplan"
// service_data.data = { blocks: [...] }

// Transformed to:
{
  id: "widget:dayplan",
  type: "dayplan",
  content: {
    data: {
      blocks: [
        {
          id: "task-456",
          title: "Study for midterm",
          minutes: 90,
          priority: "high",
          courseCode: "EECS 281"
        }
      ]
    }
  }
}
```

**Frontend Extraction** (from `useDashboardComposite.ts:349-393`):
```typescript
const dayplanWidget = widgets.find(w => w.type === 'dayplan');
const blocks = dayplanWidget?.content?.data?.blocks || [];

const unscheduledTasks: UnscheduledTask[] = blocks
  .filter(block => !block.startTime) // Only unscheduled
  .map(block => ({
    id: block.id,
    title: block.title,
    estimatedDuration: block.minutes || 30,
    priority: block.priority || 'medium',
    courseCode: block.courseCode
  }));
```

### 3. What's Due

**Data Source:** `widgets[]` with `type: "academic"`

**Backend Transformation:**
```typescript
// service_data.method = "assignments"
// service_data.data = { assignments: [...] }

// Transformed to:
{
  id: "widget:academic",
  type: "academic",
  content: {
    displayType: "urgent_deadlines",
    data: {
      urgentAssignments: [
        {
          id: "assign-789",
          title: "Problem Set 3",
          dueAt: "2025-10-11T23:59:00Z",
          courseCode: "MATH 216",
          weight: 10,
          progress: 0
        }
      ]
    }
  }
}
```

**Frontend Extraction** (from `useDashboardComposite.ts:307-346`):
```typescript
const academicWidgets = widgets.filter(w => w.type === 'academic');

const dueSoon: DueItem[] = [];
for (const widget of academicWidgets) {
  if (widget.content?.displayType === 'urgent_deadlines') {
    const assignments = widget.content.data.urgentAssignments || [];
    for (const assignment of assignments) {
      dueSoon.push({
        id: assignment.id,
        title: assignment.title,
        dueDate: assignment.dueAt,
        courseCode: assignment.courseCode,
        priority: determinePriority(assignment.dueAt),
        status: 'pending',
        type: 'assignment'
      });
    }
  }
}
```

### 4. Notes Widget

**Data Source:** `widgets[]` with `type: "notes"` (future)

**Current Status:** ‚ö†Ô∏è Not yet implemented in transformer

**Proposed Implementation:**
```typescript
// service_data.method = "notes"
// service_data.data = { recentNotes: [...] }

// Should transform to:
{
  id: "widget:notes",
  type: "notes",
  content: {
    data: {
      notes: [
        {
          id: "note-101",
          title: "EECS 281 Lecture Notes",
          courseCode: "EECS 281",
          lastModified: "2025-10-09T10:00:00Z",
          preview: "Binary search trees..."
        }
      ]
    }
  }
}
```

### 5. Course Information

**Data Source:** Context hierarchy + enrollment data

**Current Status:** ‚ö†Ô∏è Not in widget envelope yet

**Proposed Implementation:**
```typescript
// FROM contexts table (type='course') joined with enrollments
// Transformed to:
{
  id: "widget:courses",
  type: "courses",
  content: {
    data: {
      enrolled: [
        {
          id: "course-001",
          code: "EECS 281",
          name: "Data Structures and Algorithms",
          credits: 4,
          assignments: 12,
          color: "blue"
        }
      ]
    }
  }
}
```

### 6. Calendar Widget

**Data Source:** Same as Timeline (schedule events)

**Current Status:** ‚úÖ Available via `widgets[]` with `type: "schedule"`

**Frontend Usage:**
```typescript
const scheduleWidget = widgets.find(w => w.type === 'schedule');
const allEvents = scheduleWidget?.content?.data?.items || [];

// Group by date for calendar view
const eventsByDate = groupEventsByDate(allEvents);
```

---

## üöÄ How to Populate Missing Data

### Step 1: Add Data to `service_data` Table

**Option A: Via Temporal Workflow** (Recommended)
```typescript
// In a Temporal activity
import { auroraClient } from '../services/auroraDb';

await auroraClient.query(`
  INSERT INTO service_data (user_id, method, fetched_at, data, context_id)
  VALUES ($1, $2, NOW(), $3, $4)
  ON CONFLICT (user_id, method, fetched_at)
  DO UPDATE SET data = EXCLUDED.data
`, [userId, 'courses', coursesData, contextId]);
```

**Option B: Via API Endpoint**
```typescript
// In api-router
router.post('/mobile/sync/courses', async (req, res) => {
  const { courses } = req.body;
  const userId = req.user.id;

  await auroraClient.query(`
    INSERT INTO service_data (user_id, method, data, fetched_at)
    VALUES ($1, 'courses', $2, NOW())
  `, [userId, JSON.stringify({ enrolled: courses })]);

  // Invalidate dashboard cache
  await redisClient.del(`dashboard:v1:${userId}:home:campus`);

  res.json({ success: true });
});
```

### Step 2: Add Transformer Logic

**File:** `services/api-router/src/services/dashboard-composite-transformer.ts`

**Add to `createMvpV1Widgets()` function:**
```typescript
function createMvpV1Widgets(complete: any, context: string): WidgetEnvelope[] {
  const widgets: WidgetEnvelope[] = [];

  // ... existing widgets (weather, schedule, etc.)

  // Add courses widget
  if (complete.courses) {
    widgets.push({
      id: 'widget:courses',
      type: 'courses',
      content: {
        data: {
          enrolled: complete.courses.enrolled || []
        }
      }
    });
  }

  return widgets;
}
```

### Step 3: Update Frontend Hook

**File:** `src/hooks/home/useDashboardComposite.ts`

**Add extraction logic:**
```typescript
function transformCompositeResponse(apiData: any): DashboardCompositeResponse {
  const widgets = apiData.widgets || [];

  // ... existing extractions

  // Extract courses
  const coursesWidget = widgets.find((w: any) => w.type === 'courses');
  const courses = coursesWidget?.content?.data?.enrolled || [];

  return {
    // ... existing fields
    courses, // Add to response type
  };
}
```

### Step 4: Update TypeScript Types

**Add to `DashboardCompositeResponse` interface:**
```typescript
export interface DashboardCompositeResponse {
  // ... existing fields
  courses: Course[];
}

export interface Course {
  id: string;
  code: string;
  name: string;
  credits: number;
  assignments: number;
  color?: string;
}
```

### Step 5: Use in Component

**In your React component:**
```typescript
import { useDashboardComposite } from '@/hooks/home/useDashboardComposite';

export function CourseInformation() {
  const { data, isLoading } = useDashboardComposite({
    tab: 'home',
    context: 'campus'
  });

  const courses = data?.courses || [];

  if (isLoading) return <Skeleton />;

  if (courses.length === 0) {
    return <EmptyState />;
  }

  return (
    <div className="grid grid-cols-2 gap-3">
      {courses.map(course => (
        <CourseCard key={course.id} course={course} />
      ))}
    </div>
  );
}
```

---

## üìù Available Widget Types (Current)

| Widget Type | Data Source (`service_data.method`) | Status | Used By |
|-------------|-------------------------------------|--------|---------|
| `weather` | `weather` | ‚úÖ Active | Header, Weather widget |
| `schedule` | `schedule` | ‚úÖ Active | Timeline, Calendar |
| `academic` | `assignments` | ‚úÖ Active | What's Due |
| `dayplan` | `dayplan` | ‚úÖ Active | Task Bank |
| `context_status` | N/A (computed) | ‚úÖ Active | Connection warnings |
| `notes` | `notes` | ‚ùå Not implemented | Notes widget |
| `courses` | `enrollments` + `contexts` | ‚ùå Not implemented | Course Information |
| `announcements` | `announcements` | ‚ö†Ô∏è Partial | Admin announcements |
| `dining` | `dining` | ‚ùå Not implemented | Dining widget |
| `parking` | `parking` | ‚úÖ Active (in BFF) | ‚ö†Ô∏è Not in frontend yet |

---

## üîÑ Real-time Updates (Ably Deltas)

**How It Works:**

1. **Server publishes delta** when `service_data` changes:
```typescript
// After inserting new assignment
await ablyService.publishDashboardDelta(userId, {
  type: 'dashboard.delta',
  baseEtag: currentEtag,
  seq: nextSeq,
  ops: [
    {
      op: 'upsert',
      id: 'widget:academic',
      value: updatedAcademicWidget
    }
  ]
});
```

2. **Frontend receives delta** and applies surgical update:
```typescript
// In Ably subscription handler
ablyChannel.subscribe('dashboard.delta', (message) => {
  const delta = message.data;

  // Apply ops to cached widget array
  for (const op of delta.ops) {
    if (op.op === 'upsert') {
      updateWidget(op.id, op.value);
    } else if (op.op === 'remove') {
      removeWidget(op.id);
    }
  }

  // Recompute derived data
  const updatedResponse = transformCompositeResponse(updatedData);
  queryClient.setQueryData(['dashboard-composite', ...], updatedResponse);
});
```

---

## üêõ Debugging Tips

### Check if data exists in `service_data`:
```sql
SELECT method, data, fetched_at
FROM service_data
WHERE user_id = '06ea6226-c327-483b-9bc6-e554af6a22a1'
ORDER BY fetched_at DESC
LIMIT 20;
```

### Check BFF response structure:
```bash
curl -H "x-user-id: USER_ID" \
  "http://localhost:3001/dashboard/v1/composite?tab=home&context=campus" \
  | jq '.widgets | map({type, id})'
```

### Check frontend transformation:
```typescript
// Add in useDashboardComposite.ts
console.log('[Dashboard] Raw API response:', data);
console.log('[Dashboard] Transformed response:', transformedData);
```

### Check Redis cache:
```bash
redis-cli GET "dashboard:v1:USER_ID:home:campus"
```

---

## üìö Related Documentation

- **Backend:** `services/api-router/docs/bff-dashboard-v1.md`
- **Real-time:** `services/api-router/docs/realtime-dashboard-deltas.md`
- **Schema:** `infrastructure/database/migrations/*_service_data.sql`
- **Frontend Hook:** `services/dormway-lockedin/src/hooks/home/useDashboardComposite.ts`
- **Transformer:** `services/api-router/src/services/dashboard-composite-transformer.ts`

---

## ‚úÖ Next Steps to Populate Home Page

1. **Audit Current Data:**
   ```sql
   SELECT DISTINCT method FROM service_data WHERE user_id = 'YOUR_USER_ID';
   ```

2. **Identify Missing Widgets:**
   - Notes (recent notes preview)
   - Courses (enrollment data)
   - Announcements (campus-wide or course-specific)

3. **Add Data Sources:**
   - Create Temporal workflows to populate `service_data`
   - OR add manual sync endpoints

4. **Add Transformer Logic:**
   - Update `createMvpV1Widgets()` to handle new types
   - Add runtime guards (`ensureCourses()`, etc.)

5. **Update Frontend:**
   - Add extraction logic in `transformCompositeResponse()`
   - Update TypeScript types
   - Use in components

6. **Test End-to-End:**
   - Insert test data in `service_data`
   - Verify BFF transformation
   - Check frontend rendering

---

**Current Status:** The infrastructure is FULLY BUILT and WORKING. You just need to:
1. Populate `service_data` with the data you want
2. Add extraction logic in the transformer
3. Use it in your React components

The widget envelope system handles all the caching, real-time updates, and type safety automatically! üéâ
