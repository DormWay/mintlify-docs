---
title: "Schema Comparison Report   2025 08 28"
description: "These campus detection functions need to be deployed to production:"
---

# Schema Comparison Report: Aurora (Production) vs Local
*Generated: 2025-08-28*

## Summary
- **Local Schema**: 4,239 lines
- **Aurora Schema**: 4,209 lines
- **Status**: ‚ö†Ô∏è Schemas have differences

## Table Differences

### Tables ONLY in Local (not in Aurora) ‚úÖ
- `context_location_mapping` - New mapping table for context-location relationships (not yet deployed to production)

### Tables ONLY in Aurora (not in Local) ‚ö†Ô∏è
- `syllabus_embeddings` - Vector embedding table for syllabus search functionality (uses pgvector extension)

## Function Differences

### Functions ONLY in Local (not in Aurora) ‚úÖ
These campus detection functions need to be deployed to production:
- `detect_campus(lat, lon)` - Basic campus detection
- `detect_campus_with_priority(lat, lon)` - Campus detection with priority scoring
- `get_user_current_campus(user_id)` - Get user's current campus
- `is_user_on_campus(user_id)` - Check if user is on campus

### Functions ONLY in Aurora (not in Local) ‚ö†Ô∏è
These functions exist in production but not locally:
- `cleanup_old_predictions()` - Cleanup function for prediction history
- `get_user_deviation_patterns(user_id, days)` - User behavior pattern analysis
- `get_user_hourly_patterns(user_id, days)` - Hourly activity patterns
- `search_syllabus_content(embedding, user_id, threshold, count)` - Vector search for syllabus

## Index Differences

### Indexes ONLY in Local
- `idx_context_location_mapping_context` - Index on context_location_mapping table
- `idx_context_location_mapping_location` - Index on context_location_mapping table
- `idx_locations_enrollment` - Optimized index for campus enrollment sorting
- `idx_locations_priority` - Modified with WHERE clause for campus-only

### Indexes ONLY in Aurora
- `idx_syllabus_embeddings_chunk_index` - Related to syllabus embeddings
- `idx_syllabus_embeddings_syllabus_id` - Related to syllabus embeddings
- `idx_syllabus_embeddings_vector_cosine` - HNSW vector index for cosine similarity
- `idx_syllabus_embeddings_vector_ip` - HNSW vector index for inner product

## Critical Analysis

### üö® High Priority Items
1. **Campus Detection Functions Missing in Production**
   - The local environment has critical campus detection functions that are NOT in production
   - These are likely needed for the location-based features
   - Action: Create migration to add these functions to Aurora

2. **Syllabus Embeddings in Production Only**
   - Production has vector search capability that local doesn't have
   - This might be legacy or a feature not fully implemented
   - Action: Determine if this is still needed or can be removed

### üìä Impact Assessment
- **Campus Detection**: Without these functions in production, location-based features may not work correctly
- **Pattern Analysis**: Aurora has analytics functions that could be useful locally for testing
- **Vector Search**: The syllabus embedding feature appears to be production-only

### üîß Recommended Actions
1. **Immediate**: Deploy campus detection functions to Aurora
   ```sql
   -- Functions to deploy:
   - detect_campus(lat, lon)
   - detect_campus_with_priority(lat, lon)
   - get_user_current_campus(user_id)
   - is_user_on_campus(user_id)
   ```

2. **Review**: Determine if syllabus_embeddings and related functions are still needed
   - If yes: Sync to local for testing
   - If no: Plan removal from production

3. **Consider**: Sync user pattern analysis functions to local if actively used

4. **Maintenance**: Add cleanup_old_predictions() to local if needed for testing

## Migration Status
- Local appears to have newer location-based features not yet in production
- Aurora has some analytics and vector search features not in local
- Overall: Local is ahead in campus features, Aurora has additional analytics

## Files for Reference
- Local schema dump: `/tmp/local_schema.sql`
- Aurora schema dump: `/tmp/aurora_schema.sql`
- Full diff: `/tmp/schema_diff.txt`
