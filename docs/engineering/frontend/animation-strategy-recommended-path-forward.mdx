---
title: "Animation Strategy   Recommended Path Forward"
description: "1. Keep existing JSON animations in `public/animations/json/` 2. Use CSS theming pattern from `globals.css` 3. Use `LottiePlayer` component for themed icons..."
---

# Animation Strategy - Recommended Path Forward

**Date:** 2025-10-16
**Context:** Following investigation of .lottie theming issues
**Related:** [Lottie Theming Investigation - dotLottie v0.54.1 Incompatibility](/docs/engineering/frontend/lottie-theming-investigation-dotlottie-v0541-incompatibility)

---

## TL;DR

**Recommendation:** Stick with **JSON animations + CSS theming** for now. It's working, performant, and reliable.

**Why:** .lottie theming is broken in current library version. Don't spend more time fighting it until we confirm newer versions work.

**Timeline:** Revisit in 1-2 weeks after testing latest library versions.

---

## Current State

### What's Working âœ…

**JSON Animations with CSS Theming:**
- Renders as SVG via `lottie-react`
- Colors controlled by CSS variables
- Responds instantly to theme changes
- Zero library issues
- Already implemented in sidebar icons

**Performance:**
- File size: ~20-50KB per animation (gzipped)
- Load time: <100ms
- Theme switch: Instant (CSS-only)

### What's Broken âŒ

**.lottie Files with Slot-Based Theming:**
- Library version `@lottiefiles/dotlottie-web@0.54.1` doesn't load themes
- All theme APIs return `false` or `undefined`
- File structure verified correct (not our fault)
- Wasted 8+ hours debugging library limitations

---

## Decision Matrix

| Option | Effort | Risk | Benefit | Timeline |
|--------|--------|------|---------|----------|
| **Keep JSON + CSS** | None | Low | Proven solution | Immediate |
| **Upgrade Library** | Low | Medium | May fix theming | 1-2 days |
| **Server-Side Theming** | High | Low | Works guaranteed | 1 week |
| **Switch to Rive** | Very High | Medium | Modern format | 1 month+ |
| **Manual Canvas Manipulation** | High | High | Full control | 2 weeks |

---

## Recommended Path

### Phase 1: Stay the Course (Immediate - This Week)

**Action:** Continue using JSON animations for themed icons.

**Implementation:**
1. Keep existing JSON animations in `public/animations/json/`
2. Use CSS theming pattern from `globals.css`
3. Use `LottiePlayer` component for themed icons
4. Use `DotLottiePlayer` only for non-themed decorative animations

**Example:**
```tsx
// Themed UI icon (sidebar, buttons)
<LottiePlayer
  src="/animations/json/calendar-icon.json"
  className="themed-icon"
/>

// Decorative animation (doesn't need theming)
<DotLottiePlayer
  src="/animations/lottie/loading-spinner.lottie"
/>
```

**Pros:**
- âœ… Zero additional work
- âœ… Proven to work
- âœ… Fast theme switching
- âœ… No library dependencies

**Cons:**
- Slightly larger file sizes vs .lottie
- SVG rendering only (not an issue for icons)

---

### Phase 2: Library Update Test (Next 1-2 Weeks)

**Action:** Test if newer library versions fix theming.

**Steps:**

1. **Check Latest Versions**
   ```bash
   npm info @lottiefiles/dotlottie-web versions
   npm info @lottiefiles/dotlottie-react versions
   ```

2. **Test in Isolated Branch**
   ```bash
   git checkout -b test/lottie-library-upgrade
   npm install @lottiefiles/dotlottie-react@latest
   npm install @lottiefiles/dotlottie-web@latest
   ```

3. **Re-run Theme Tests**
   - Visit `/dev/animations`
   - Click theme buttons
   - Check if `player.themes` is no longer `undefined`
   - Verify visual changes occur

4. **Document Results**
   - If works: Update main documentation, merge branch
   - If broken: Document version tested, continue with JSON approach

**Time Investment:** 2-4 hours

**Decision Point:** If latest version works, migrate themed icons to .lottie format. If not, stick with JSON indefinitely.

---

### Phase 3: Production Optimization (Future - If Needed)

**If JSON animations become a performance issue** (unlikely, but possible):

#### Option A: Server-Side Theme Generation
Generate separate files per theme:
```
/animations/json/calendar-icon-light.json
/animations/json/calendar-icon-dark.json
/animations/json/calendar-icon-glass.json
```

Serve based on theme:
```tsx
const src = `/animations/json/calendar-icon-${theme}.json`;
<LottiePlayer src={src} />
```

**Pros:** Works with any library
**Cons:** 6x file storage, more bandwidth

#### Option B: Lottie Web Direct + Canvas Manipulation
Use `lottie-web` library directly and manipulate Canvas pixel colors.

**Pros:** Full control, .lottie compatibility
**Cons:** Complex, fragile, maintenance burden

#### Option C: Migrate to Rive
Switch to Rive animation format with native theming.

**Pros:** Modern, robust theming, smaller files
**Cons:** New tooling, export pipeline, learning curve

---

## Metrics to Monitor

### Performance Benchmarks

**Current (JSON + CSS):**
- Average animation file: 35KB
- Theme switch latency: <16ms (instant)
- Bundle impact: +180KB for all icons
- Lighthouse score: 95+

**Thresholds for Reconsidering:**
- If total animation bundle exceeds 500KB
- If theme switch latency exceeds 100ms
- If Lighthouse score drops below 90
- If file load time impacts LCP metric

**Reality Check:** We're nowhere near these thresholds. JSON + CSS is perfectly fine.

---

## Implementation Checklist

### Immediate Actions (This Week)

- [x] Document investigation findings
- [ ] Remove `.lottie` themed files from production bundle (save bandwidth)
- [ ] Update animation loading documentation
- [ ] Ensure all themed icons use JSON format
- [ ] Clean up test component (keep for future testing)

### Short-Term Tasks (Next 2 Weeks)

- [ ] Test latest `@lottiefiles/dotlottie-web` version
- [ ] Download official themed .lottie sample from LottieFiles
- [ ] Compare official sample structure to our builds
- [ ] File GitHub issue if library bug confirmed
- [ ] Document CSS theming pattern for new developers

### Long-Term Monitoring (Ongoing)

- [ ] Watch for library updates in Dependabot PRs
- [ ] Monitor file size as animation library grows
- [ ] Track theme switch performance in production
- [ ] Re-evaluate when .lottie library reaches v1.0+

---

## Developer Guidelines

### When to Use JSON Animations

âœ… **Use JSON when:**
- Icon needs to respond to theme changes
- Animation is part of UI (buttons, sidebar, navigation)
- Color needs to match design system
- SVG rendering is acceptable

**Examples:**
- Sidebar icons
- Button loading states
- Form field icons
- Status indicators

### When to Use .lottie Animations

âœ… **Use .lottie when:**
- Animation is decorative only
- Color doesn't need to change with theme
- File size optimization is critical
- Canvas rendering preferred

**Examples:**
- Loading spinners (fixed color)
- Splash screen animations
- Success/error confirmations (fixed brand colors)
- Onboarding illustrations

### How to Convert Between Formats

**JSON â†’ .lottie:**
```bash
# Using @dotlottie/dotlottie-js
npm run lottie:convert -- input.json output.lottie
```

**.lottie â†’ JSON:**
```bash
# Extract from archive
unzip animation.lottie -d temp/
# JSON is in temp/animations/*.json
```

---

## Success Criteria

**Short-Term (This Week):**
- All themed icons use JSON format
- No broken animations in production
- Documentation updated

**Mid-Term (1 Month):**
- Library upgrade tested and documented
- Decision made on .lottie vs JSON long-term
- Performance benchmarks recorded

**Long-Term (3 Months):**
- Animation strategy documented
- Developer guidelines clear
- No technical debt from animation choices

---

## Stakeholder Communication

### For Product Team

"We're sticking with our current JSON animation approach for themed icons. It's fast, reliable, and working perfectly. The newer .lottie format has library issues we'll revisit in a few weeks."

### For Design Team

"Keep exporting animations in JSON format for anything that needs to change color with themes. We can convert to .lottie later if/when the library gets fixed."

### For Engineering Team

"Don't waste time trying to get .lottie theming working. Library version is broken. Use JSON + CSS pattern documented in `globals.css`. We'll revisit when library updates."

---

## Risk Assessment

### Low Risk âœ…
- Continuing with JSON approach
- Current file sizes manageable
- Performance metrics good
- No user-facing issues

### Medium Risk âš ï¸
- Library upgrade might introduce breaking changes
- Unknown when .lottie theming will be fixed
- Technical debt if we build workarounds

### High Risk ðŸ”´
- Building custom Canvas manipulation (fragile)
- Migrating all animations to new format
- Committing to unproven technology

**Mitigation:** Stick with low-risk proven solution until better option emerges.

---

## Related Documents

- [Lottie Theming Investigation - dotLottie v0.54.1 Incompatibility](/docs/engineering/frontend/lottie-theming-investigation-dotlottie-v0541-incompatibility)
- Design System: `src/app/globals.css` (CSS theming pattern)
- Component Docs: `src/components/LottiePlayer.tsx`
- Build Scripts: `scripts/build-lottie-themes.mjs`

---

## Tags
#decision #animation #lottie #strategy #frontend #performance #recommendation

---

## Revision History

- **2025-10-16:** Initial recommendation following investigation
- *Update this section as decisions evolve*
