---
title: "Realtime Dashboard Deltas (v1)"
description: "{ \"type\": \"dashboard.delta\", \"version\": \"1.0\", \"baseEtag\": \"W/\\\"dcv1-...\\\"\", \"seq\": 1, \"ops\": [ { \"op\": \"upsert\", \"id\": \"weather\", \"value\": { /* WidgetEnvelo..."
---

# Realtime Dashboard Deltas (v1)

## Envelope
```
{
  "type": "dashboard.delta",
  "version": "1.0",
  "baseEtag": "W/\"dcv1-...\"",
  "seq": 1,
  "ops": [
    { "op": "upsert", "id": "weather", "value": { /* WidgetEnvelope */ } },
    { "op": "remove", "id": "parking" }
  ],
  "ts": "2025-08-20T12:34:56Z"
}
```

## Rules
- Sequencing: `seq` strictly increases per (user, tab, context); persisted in Redis with 24h TTL.
- Base: `baseEtag` must match the client’s current snapshot; mismatch or seq gap → client refetches snapshot.
- Coalescing: Server coalesces updates in ~500ms windows and rate-limits to ≤2 msgs/sec/user.
- Addressing: Ops are ID-addressed; clients maintain a byId map.
- Transport: Clients subscribe-only to `user:{userId}:dashboard`. Server publishes via Ably.

## References (canonical)
- Spec: `dormway-platform/services/api-router/docs/realtime-dashboard-deltas.md:8`
- Publisher: `dormway-platform/services/api-router/src/services/ably-service.ts:131`
- Diffing: `dormway-platform/services/api-router/src/services/dashboard-diff.ts:13`
