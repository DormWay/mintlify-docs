---
title: "CLAUDE_CODE_WORKTREE_OPTIMIZATION"
description: "Your worktree setup is **already excellent** with robust scripts and documentation. This guide provides **10 high-impact optimizations** to make git worktree..."
---

# Claude Code + Git Worktrees: Optimization Guide

## üéØ Executive Summary

Your worktree setup is **already excellent** with robust scripts and documentation. This guide provides **10 high-impact optimizations** to make git worktrees even more powerful for Claude Code development in the DormWay multi-repo workspace.

**Priority**: Focus on **Quick Wins** first for immediate productivity gains.

---

## üìä Current State: What's Working Well

‚úÖ **Solid Foundation**
- Complete script suite (create, list, remove, cleanup)
- Smart default branch detection
- Multi-repo support
- Safety features (uncommitted change warnings)
- Comprehensive documentation (GIT_WORKTREES.md)

‚úÖ **Good Patterns**
- TASK.md file generation
- Worktrees stored outside main workspace
- Makefile integration
- Color-coded CLI output

---

## üöÄ Optimization Recommendations

### Priority 1: Quick Wins (High Impact, Low Effort)

#### 1. **Enhanced TASK.md Template** ‚≠ê‚≠ê‚≠ê
**Status**: ‚úÖ Implemented (`.templates/TASK.md.template`)

**What**: Replace the basic TASK.md with a Claude Code-optimized template that includes:
- Context sections for architecture understanding
- Design decisions documentation
- Testing strategy checklist
- Development log for progress tracking

**Why**: Claude Code builds better context when tasks are well-documented. This template guides developers to provide information that helps Claude Code understand both the technical requirements AND the broader architectural context.

**Implementation**:
```bash
# Update worktree-create.sh to use the new template
# Line 123-144 in scripts/worktree-create.sh
```

**Next Steps**:
- [ ] Update `worktree-create.sh` to use `.templates/TASK.md.template`
- [ ] Replace template variables: `{{BRANCH_NAME}}`, `{{REPO_NAME}}`, etc.

---

#### 2. **Claude Code Launch Script** ‚≠ê‚≠ê‚≠ê
**Status**: ‚úÖ Implemented (`scripts/claude-start.sh`)

**What**: Quick launcher that:
- Opens worktree in your preferred editor (Cursor/VS Code)
- Shows worktree status, recent commits, and TASK.md summary
- Provides helpful next-step commands
- Can create worktree if it doesn't exist

**Why**: Reduces friction when starting work. Instead of `cd` + `code .`, you get contextual information and a ready-to-go environment.

**Usage**:
```bash
# Start Claude Code session
./scripts/claude-start.sh dormway-platform feat/landing-page cursor

# Or add to Makefile:
make claude-start REPO=dormway-platform BRANCH=feat/landing-page
```

**Next Steps**:
- [ ] Add `claude-start` command to Makefile
- [ ] Set `EDITOR` environment variable (cursor vs code)
- [ ] Create alias: `alias cstart='./scripts/claude-start.sh'`

---

#### 3. **Worktree Status Dashboard** ‚≠ê‚≠ê
**Status**: üî® Recommended

**What**: Enhanced `worktree-list` that shows:
- Branch status (ahead/behind remote)
- Last commit time
- Uncommitted changes count
- Associated PR status (if applicable)
- Disk usage per worktree

**Why**: Quick visibility into all active work helps you prioritize and clean up stale worktrees.

**Implementation**:
```bash
# Enhance scripts/worktree-list.sh to show:
# - git status --porcelain | wc -l (uncommitted changes)
# - git log -1 --format="%ar" (last commit time)
# - git rev-list --left-right --count origin/main...HEAD (ahead/behind)
```

**Example Output**:
```
üå≥ Git Worktrees Status

üìÅ dormway-platform
   ‚úì feat/landing-page
      Path: ../dormway-worktrees/dormway-platform-feat/landing-page
      Status: 3 uncommitted files | 2 commits ahead | Updated 2 hours ago
      Last commit: fix: update hero section layout

   ‚úì hotfix/auth-bug
      Path: ../dormway-worktrees/dormway-platform-hotfix/auth-bug
      Status: Clean | 1 commit ahead | Updated 3 days ago
      Last commit: hotfix: resolve auth token expiry
```

---

#### 4. **Quick Branch Templates** ‚≠ê‚≠ê
**Status**: üî® Recommended

**What**: Predefined workflows for common scenarios:
```bash
# Feature development
./scripts/worktree-feature.sh <repo> <feature-name>
# Creates: feat/<feature-name>

# Bug fix
./scripts/worktree-bugfix.sh <repo> <bug-description>
# Creates: bug/<bug-description>

# Hotfix (from main)
./scripts/worktree-hotfix.sh <repo> <issue-name>
# Creates: hotfix/<issue-name> from production branch

# Experiment (safe to delete)
./scripts/worktree-experiment.sh <repo> <experiment-name>
# Creates: experiment/<experiment-name>
```

**Why**: Consistent branch naming + pre-configured TASK.md templates per workflow type.

---

### Priority 2: Workflow Enhancements (High Impact, Medium Effort)

#### 5. **VS Code Workspace File Generation** ‚≠ê‚≠ê‚≠ê
**Status**: üî® Recommended

**What**: Auto-generate `.code-workspace` files for worktrees.

**Example**:
```json
// dormway-worktrees/dormway-platform-feat-landing/.code-workspace
{
  "folders": [
    {
      "path": ".",
      "name": "feat/landing-page (dormway-platform)"
    },
    {
      "path": "../../dormway-beta-workspace/.repos/dormway-api-2",
      "name": "API Gateway (reference)"
    }
  ],
  "settings": {
    "git.defaultBranchName": "feat/landing-page",
    "files.exclude": {
      "**/node_modules": true
    }
  },
  "extensions": {
    "recommendations": [
      "dbaeumer.vscode-eslint",
      "esbenp.prettier-vscode"
    ]
  }
}
```

**Benefits**:
- Open multi-repo context (worktree + reference repos)
- Per-worktree settings
- Extension recommendations
- Better Claude Code multi-repo understanding

**Implementation**:
```bash
# Add to worktree-create.sh:
# - Generate .code-workspace file
# - Include related repos as reference folders
# - Open with: code <worktree>/.code-workspace
```

---

#### 6. **Context Preservation Guide** ‚≠ê‚≠ê
**Status**: üî® Recommended (Documentation)

**What**: Document strategies for maintaining Claude Code context across worktrees.

**Key Sections**:
- How Claude Code builds context per-worktree
- Best practices for documenting architecture decisions
- Using TASK.md to "prime" Claude Code
- Exporting/importing context between worktrees
- Pattern: Create "ARCHITECTURE.md" in each worktree

**Example ARCHITECTURE.md**:
```markdown
# Architecture Context for Claude Code

## This Feature's Scope
This worktree implements the landing page redesign for the marketing site.

## Key Files
- `apps/dormway-lockedin/src/app/(marketing)/page.tsx` - Main landing page
- `apps/dormway-lockedin/src/components/hero/` - Hero section components
- `apps/dormway-lockedin/src/components/features/` - Features section

## Design System
We use the DormWay design system from `packages/dw-design/`.
- Colors: `theme.colors.brand.blue`
- Spacing: `space.4`, `space.8`, etc.
- Components: `<Button>`, `<Card>`, `<Hero>`

## Related Patterns
See `apps/dormway-admin/src/app/(marketing)/` for similar patterns used in admin portal.

## Testing
Run `npm test` for unit tests, `npm run e2e` for Playwright tests.
```

---

#### 7. **Git Worktree Hooks** ‚≠ê
**Status**: üî® Recommended (Advanced)

**What**: Git hooks that trigger on worktree events.

**Examples**:
```bash
# .git/hooks/post-worktree-add
#!/bin/bash
# Runs after creating a worktree
# - Copy .env files
# - Run npm install
# - Open in editor
# - Create Jira ticket

# .git/hooks/pre-worktree-remove
#!/bin/bash
# Runs before removing a worktree
# - Check for uncommitted changes
# - Verify PR is merged
# - Archive TASK.md to .workspace/archive/
```

---

### Priority 3: Advanced Optimizations (High Impact, High Effort)

#### 8. **Dependency Optimization** ‚≠ê‚≠ê
**Status**: üî® Recommended

**Problem**: Each worktree has its own `node_modules/`, wasting disk space.

**Solutions**:

**Option A: pnpm (Recommended)**
```bash
# pnpm uses content-addressable storage
# All worktrees share the same packages
cd worktree
pnpm install  # Fast, minimal disk usage
```

**Option B: Symlink node_modules**
```bash
# In worktree-create.sh, add:
ln -s ../../dormway-beta-workspace/.repos/dormway-platform/node_modules ./node_modules
```

**Option C: npm workspaces**
```bash
# Create a parent workspace that includes all worktrees
# Shares dependencies automatically
```

**Trade-offs**:
- ‚úÖ Saves 100s of MB per worktree
- ‚ö†Ô∏è Requires package version compatibility
- ‚ö†Ô∏è May cause issues if worktrees have different dependencies

---

#### 9. **AI Context Export/Import** ‚≠ê‚≠ê‚≠ê
**Status**: üî® Recommended (Future)

**What**: Scripts to export/import Claude Code's understanding between worktrees.

**Use Case**:
- Work on `feat/auth` in worktree-1
- Claude Code builds deep context about auth patterns
- Export that context to work on `feat/auth-ui` in worktree-2

**Conceptual Implementation**:
```bash
# Export context
./scripts/claude-export-context.sh

# Creates:
# - CONTEXT.md (architectural decisions)
# - FILE_MAP.md (important files and their purposes)
# - PATTERNS.md (coding patterns discovered)

# Import to another worktree
./scripts/claude-import-context.sh <from-worktree>
```

**Reality Check**: Claude Code context is ephemeral and not easily serializable. This would require:
- Comprehensive documentation generation
- Pattern extraction from conversation history
- Architectural decision records (ADRs)

**Practical Alternative**: Focus on excellent documentation that serves as "portable context":
- Detailed TASK.md
- ARCHITECTURE.md per worktree
- Pattern guides in `.templates/`

---

#### 10. **Automated Cleanup & Archival** ‚≠ê
**Status**: üî® Recommended

**What**: Automatic detection and cleanup of stale worktrees.

**Features**:
```bash
# Detect stale worktrees (no commits in 30 days)
./scripts/worktree-stale.sh

# Auto-archive TASK.md and logs before cleanup
./scripts/worktree-archive.sh <repo> <branch>
# Saves to: .workspace/archive/<repo>/<branch>/

# Scheduled cleanup (via cron)
# Weekly: detect merged branches
# Monthly: detect stale worktrees
```

**Archive Structure**:
```
.workspace/archive/
‚îú‚îÄ‚îÄ dormway-platform/
‚îÇ   ‚îú‚îÄ‚îÄ feat-landing-page/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TASK.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ git-log.txt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ archived-2025-11-13.txt
‚îÇ   ‚îî‚îÄ‚îÄ bug-auth-fix/
‚îî‚îÄ‚îÄ ios-clean/
    ‚îî‚îÄ‚îÄ feat-onboarding/
```

---

## üé® User Experience Improvements

### A. **Better CLI Output**

**Current**: Basic colored output
**Enhanced**: Rich, interactive CLI

```bash
# Use rich libraries like:
# - gum (interactive prompts)
# - rich-cli (beautiful tables)
# - fzf (fuzzy finding worktrees)

# Example:
./scripts/worktree-list.sh | fzf --preview 'cat {}/TASK.md'
# Interactive selection with live preview
```

---

### B. **Worktree Aliases**

Add to `.bashrc` / `.zshrc`:
```bash
# Quick worktree commands
alias wtc='make worktree-create'
alias wtl='make worktree-list'
alias wtr='make worktree-remove'
alias wtclean='make worktree-cleanup'
alias wtstart='./scripts/claude-start.sh'

# Quick navigation
alias wt='cd ../dormway-worktrees'
alias wtplat='cd ../dormway-worktrees/dormway-platform-'
alias wtapi='cd ../dormway-worktrees/dormway-api-2-'
alias wtios='cd ../dormway-worktrees/ios-clean-'

# Fuzzy find and cd to worktree
wtcd() {
  local worktree=$(fd . ../dormway-worktrees --type d --max-depth 1 | fzf)
  cd "$worktree"
}
```

---

### C. **Git Aliases**

Add to `.gitconfig`:
```ini
[alias]
  wt = worktree
  wtl = worktree list
  wta = worktree add
  wtr = worktree remove
  wtp = worktree prune
```

---

## üìà Metrics & Monitoring

Track worktree usage to optimize workflow:

```bash
# How many worktrees are active?
./scripts/worktree-metrics.sh

# Output:
# Total worktrees: 5
# Average age: 8 days
# Largest worktree: dormway-platform-feat-auth (1.2GB)
# Oldest worktree: ios-clean-experiment-react (45 days)
# Stale worktrees (>30 days): 1
```

---

## üß™ Testing Recommendations

### Test Scenarios for Worktree Scripts

1. **Multi-repo consistency**
   - Create worktrees for all repos
   - Verify branch names match
   - Test cross-repo changes

2. **Error handling**
   - Missing base branch
   - Already existing worktree
   - No git credentials
   - Network failures

3. **Cleanup edge cases**
   - Orphaned worktrees (directory deleted)
   - Unmerged branches
   - Uncommitted changes
   - Already merged but not detected

---

## üìö Documentation Updates

### Update CLAUDE.md

Add worktree-specific guidance:

```markdown
## Git Worktrees for Claude Code

When working with Claude Code in this workspace, use git worktrees for parallel development:

1. **Create a worktree for your task**:
   ```bash
   ./scripts/claude-start.sh dormway-platform feat/my-feature
   ```

2. **Fill out TASK.md** to give Claude Code context about:
   - What you're building and why
   - Architecture decisions
   - Files you'll modify
   - Testing strategy

3. **Work with Claude Code** in the worktree:
   - Context is preserved per-worktree
   - You can have multiple Claude sessions running
   - No context switching between branches

4. **When done, clean up**:
   ```bash
   make worktree-remove REPO=dormway-platform BRANCH=feat/my-feature
   ```

### Why Worktrees?

- ‚úÖ No context loss when switching tasks
- ‚úÖ Work on multiple features simultaneously
- ‚úÖ Safe experimentation without affecting main branch
- ‚úÖ Each worktree maintains its own Claude Code context
```

---

## üîÑ Integration with Existing Workspace

### Makefile Updates

Add these commands to `Makefile`:

```makefile
# Claude Code specific commands
claude-start:
	@./scripts/claude-start.sh $(REPO) $(BRANCH) $(EDITOR)

worktree-status:
	@./scripts/worktree-status.sh  # Enhanced list with metrics

worktree-feature:
	@./scripts/worktree-feature.sh $(REPO) $(NAME)

worktree-bugfix:
	@./scripts/worktree-bugfix.sh $(REPO) $(NAME)

worktree-archive:
	@./scripts/worktree-archive.sh $(REPO) $(BRANCH)
```

---

## üéØ Implementation Roadmap

### Phase 1: Quick Wins (1-2 hours)
- [x] Create enhanced TASK.md template
- [x] Create claude-start.sh script
- [ ] Update Makefile with new commands
- [ ] Add worktree aliases to README

### Phase 2: Workflow (2-4 hours)
- [ ] Implement worktree-status.sh (enhanced list)
- [ ] Create branch template scripts (feature, bugfix, hotfix)
- [ ] Add VS Code workspace generation
- [ ] Document context preservation strategies

### Phase 3: Advanced (4-8 hours)
- [ ] Set up dependency optimization (pnpm or symlinks)
- [ ] Create archive/cleanup automation
- [ ] Add git hooks for worktrees
- [ ] Implement metrics tracking

---

## üí° Best Practices for Claude Code + Worktrees

### 1. **One Feature = One Worktree**
Don't reuse worktrees. Each feature gets its own isolated environment.

### 2. **Document Context in TASK.md**
Fill out TASK.md immediately. This "primes" Claude Code with context.

### 3. **Keep Worktrees Short-Lived**
Aim for 1-2 weeks max. Merge and clean up to avoid clutter.

### 4. **Use Descriptive Branch Names**
`feat/auth-oauth2-integration` > `feat/auth` > `feature1`

### 5. **Archive Before Deleting**
Save TASK.md and learnings to `.workspace/archive/` before removing worktrees.

### 6. **Regular Cleanup**
Run `make worktree-cleanup` weekly to remove merged branches.

---

## ü§î When NOT to Use Worktrees

Worktrees aren't always the answer:

‚ùå **Quick bug fixes on current branch** - Just fix it
‚ùå **Reviewing PRs** - Use GitHub or `gh pr checkout`
‚ùå **One-line changes** - Not worth the overhead
‚ùå **Exploring code** - Use `git log` and file browsing

‚úÖ **DO use worktrees for**:
- Multi-day features
- Parallel work on multiple features
- Major refactoring that might fail
- Hotfixes while working on features
- Experiments that might be abandoned

---

## üìä Expected Impact

### Productivity Gains

| Scenario | Without Worktrees | With Worktrees | Time Saved |
|----------|-------------------|----------------|------------|
| Context switching | 10-15 min | 0 min | 100% |
| Parallel features | Impossible | Easy | ‚àû |
| Hotfix during feature | 5 min (stash, switch) | 30 sec (new worktree) | 90% |
| Claude Code warm-up | Every switch | Once per worktree | 80% |

### Developer Experience

- **Before**: "Let me stash my changes, switch branches, and re-explain everything to Claude..."
- **After**: "Let me open my worktree - Claude already knows what I'm doing!"

---

## üöÄ Next Steps

### Immediate (Do Today)
1. ‚úÖ Review enhanced TASK.md template
2. ‚úÖ Try `./scripts/claude-start.sh` for your next task
3. Add Makefile commands for claude-start
4. Share this guide with your team

### This Week
1. Implement enhanced worktree-status.sh
2. Create branch template scripts
3. Add VS Code workspace generation
4. Update CLAUDE.md with worktree guidance

### This Month
1. Evaluate dependency optimization (pnpm)
2. Set up automated cleanup
3. Create archive system for completed worktrees
4. Measure productivity impact

---

## üìû Feedback & Iteration

This setup should evolve based on your actual usage:

- Track which scripts you use most
- Note pain points and friction
- Measure time saved
- Gather team feedback

**Goal**: Make git worktrees + Claude Code feel seamless and natural.

---

## üéì Resources

- [Git Worktrees Documentation](https://git-scm.com/docs/git-worktree)
- [Mastering Git Worktrees with Claude Code](https://medium.com/@dogukantuna/mastering-git-worktrees-with-claude-code-for-parallel-development-workflow)
- Internal: `GIT_WORKTREES.md` (comprehensive guide)
- Internal: `CLAUDE.md` (workspace overview)

---

**Created**: 2025-11-13
**Version**: 1.0
**Status**: ‚úÖ Ready for Implementation
