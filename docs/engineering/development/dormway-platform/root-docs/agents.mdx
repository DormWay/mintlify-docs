---
title: "AGENTS"
---

# Repository Guidelines

## Project Structure & Module Organization
- `services/` contains deployable apps: `api-router` (public API), `engine` (Temporal workers), `ably-relay`, `canvas-sync`, `dormway-admin`, `marketing-site`, and more. Keep service-specific assets under `src/` and expose shared code via `shared/*`.
- `infrastructure/` versions Docker compose files and Terraform (`terraform-new`). `scripts/` centralizes Doppler, seeding, and release helpers; `docs/` holds runbooks and integration notes; `schemas/`, `migrations/`, and `university-logos/` back data flows.
- Place new config templates next to their service as `.env.local.example` so Doppler mappings remain discoverable.

## Build, Test, and Development Commands
- `make dev` bootstraps the full stack with Doppler secrets and seeds; run `make dev-build` after dependency changes or `make dev-fresh` for a clean rebuild. Use workspace `make sync` to reset your Neon branch before starting.
- `make status`, `make logs s=api-router`, and `make stop` monitor and shut down containers. `make zuplo` launches the Zuplo gateway used in place of LocalStack.
- For targeted workflows, `make test-service s=engine` focuses Jest on one service, while `npm run lint` or `npm run typecheck` executed within a service keeps it clean.

## Coding Style & Naming Conventions
- TypeScript dominates; use Node 20, two-space indentation, semicolons, and single quotes. Keep runtime code in `src/`, compiled output in `dist/` or `lib/`.
- Follow camelCase for variables/functions, PascalCase for classes/types, kebab-case for directories. Run ESLint and Prettier via `npm run lint` and `npm run format:check` inside services such as `services/engine`.

## Testing Guidelines
- Jest with `ts-jest` is the default; colocate specs as `*.test.ts` in the owning service (`services/engine/src/__tests__/Example.test.ts`).
- Run the full suite with `make test`; skip-heavy services should still stub tests so CI passes. Update or add coverage whenever you touch workflows, queue handlers, or API contracts.

## Commit & Pull Request Guidelines
- Use Conventional Commits (`feat:`, `fix:`, `chore:`) mirroring existing history (`feat: add dorm allocation rules`). Scope optional for services, e.g., `fix(api-router): handle auth fallback`.
- PRs must summarize intent, link Linear issues, describe testing (`make test`, manual flows), and include screenshots for UI-facing services (`dormway-admin`, `marketing-site`). Note risks, migrations, and required Doppler config changes.

## Security & Configuration Tips
- Pull secrets through Doppler (`make doppler-setup`, `doppler run -- npm test`) and keep `.env.local` files out of git. For database access, use `make neon-connection` in the workspace root and `doppler run -- psql "$DATABASE_URL"` in this repo.
- Prefer parameterized configs over hardcoded credentials, scrub logs before sharing, and rotate short-lived tokens via Doppler when pairing with contractors.
