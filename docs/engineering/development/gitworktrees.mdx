---
title: "GIT_WORKTREES"
description: "This guide explains how to use Git worktrees with Claude Code to enable parallel development workflows in the DormWay multi-repository workspace."
---

# Git Worktrees for Parallel Development with Claude Code

This guide explains how to use Git worktrees with Claude Code to enable parallel development workflows in the DormWay multi-repository workspace.

## üéØ Why Git Worktrees?

**The Problem**: When you context-switch between branches, Claude Code loses its deep understanding of your codebase. Every branch switch means:
- Lost context about your current work
- Need to re-explain architecture and patterns
- 10-15 minutes of warm-up time
- Reduced productivity

**The Solution**: Git worktrees let you check out multiple branches into separate directories, each maintaining its own Claude Code context. Work on multiple features simultaneously without losing momentum!

## üèóÔ∏è Architecture

```
dormway-beta-workspace/          # Main workspace
‚îú‚îÄ‚îÄ .repos/                      # Original repositories
‚îÇ   ‚îú‚îÄ‚îÄ dormway-platform/        # Main branch
‚îÇ   ‚îú‚îÄ‚îÄ dormway-api-2/           # Main branch
‚îÇ   ‚îî‚îÄ‚îÄ ios-clean/               # Main branch
‚îî‚îÄ‚îÄ ../dormway-worktrees/        # Worktrees directory (created automatically)
    ‚îú‚îÄ‚îÄ dormway-platform-feat-auth/     # Feature branch worktree
    ‚îú‚îÄ‚îÄ dormway-platform-hotfix-bug/    # Hotfix branch worktree
    ‚îú‚îÄ‚îÄ ios-clean-feat-onboarding/      # iOS feature worktree
    ‚îî‚îÄ‚îÄ dormway-api-2-feat-endpoints/   # API feature worktree
```

Each worktree:
- ‚úÖ Maintains complete isolation
- ‚úÖ Shares the same Git history
- ‚úÖ Preserves Claude Code context
- ‚úÖ No `git stash` needed
- ‚úÖ Zero risk of wrong-branch commits

## üöÄ Quick Start

### Create a Worktree for One Repo

```bash
# Create a worktree for a specific repository
make worktree-create REPO=dormway-platform BRANCH=feat/landing-page-redesign

# Or use the script directly (base branch auto-detected)
./scripts/worktree-create.sh dormway-platform feat/landing-page-redesign

# Or specify a base branch explicitly
./scripts/worktree-create.sh dormway-platform feat/landing-page-redesign main
```

This will:
1. **Auto-detect** the default branch (from remote HEAD, or fallback to `main`/`master`)
2. **Fetch** the base branch if it doesn't exist locally
3. Create a new branch `feat/landing-page-redesign` from the base branch
4. Check it out in `../dormway-worktrees/dormway-platform-feat/landing-page-redesign`
5. Create a `TASK.md` file for documentation
6. Ready for Claude Code!

**Note**: The scripts automatically detect the default branch for each repository, so you don't need to specify it unless you want a different base branch.

### Create Worktrees for All Repos

```bash
# Create worktrees with the same branch name across all repos
make worktree-create-all BRANCH=feat/multi-repo-feature

# Or use the script directly
./scripts/worktree-create-all.sh feat/multi-repo-feature main
```

### List All Worktrees

```bash
make worktree-list

# Or
./scripts/worktree-list.sh
```

### Remove a Worktree

```bash
make worktree-remove REPO=dormway-platform BRANCH=feat/landing-page-redesign

# Or
./scripts/worktree-remove.sh dormway-platform feat/landing-page-redesign
```

### Clean Up Merged Worktrees

```bash
make worktree-cleanup

# Or interactively
./scripts/worktree-cleanup.sh true
```

## üí° Common Use Cases

### 1. Parallel Feature Development

Work on multiple features simultaneously without context switching:

```bash
# Feature 1: Landing page redesign
make worktree-create REPO=dormway-platform BRANCH=feat/landing-page-redesign
cd ../dormway-worktrees/dormway-platform-feat/landing-page-redesign
code .  # Open in Cursor/VS Code
# Claude Code now has full context for landing page work

# Feature 2: API endpoints (in parallel!)
make worktree-create REPO=dormway-api-2 BRANCH=feat/new-endpoints
cd ../dormway-worktrees/dormway-api-2-feat/new-endpoints
code .  # Open in separate Cursor/VS Code window
# Claude Code has separate context for API work

# Feature 3: iOS onboarding (also in parallel!)
make worktree-create REPO=ios-clean BRANCH=feat/new-onboarding
cd ../dormway-worktrees/ios-clean-feat/new-onboarding
code .  # Open in third Cursor/VS Code window
# Claude Code has separate context for iOS work
```

Now you have **3 separate Claude Code sessions**, each with full context for their respective features!

### 2. Hotfix While Developing

Handle urgent bugs without interrupting your feature work:

```bash
# You're working on a feature
cd ../dormway-worktrees/dormway-platform-feat/my-feature
# Claude Code understands your feature work

# Urgent bug report comes in!
make worktree-create REPO=dormway-platform BRANCH=hotfix/critical-bug
cd ../dormway-worktrees/dormway-platform-hotfix/critical-bug
code .  # New Claude Code session for the bug
# Fix the bug with full Claude Code context

# After fixing, return to your feature
cd ../dormway-worktrees/dormway-platform-feat/my-feature
# Claude Code still remembers everything about your feature!
```

### 3. Safe Framework Migrations

Test major refactoring in isolation:

```bash
# Test React 18 upgrade without touching main
make worktree-create REPO=dormway-platform BRANCH=experiment/react-18-upgrade
cd ../dormway-worktrees/dormway-platform-experiment/react-18-upgrade

# Let Claude Code handle the migration
# If it goes wrong, just delete the worktree - no git history pollution!
```

### 4. Enhanced Code Reviews

Prepare PRs with comprehensive improvements:

```bash
# Create worktree from existing feature branch
cd .repos/dormway-platform
git worktree add ../../dormway-worktrees/dormway-platform-review-feat-auth feature/auth

cd ../../dormway-worktrees/dormway-platform-review-feat-auth

# Use Claude Code to:
# - Add comprehensive docstrings
# - Generate documentation
# - Create unit tests
# - Add type hints
# - Clean up code style
```

### 5. Model Comparison

Compare different AI models on the same task:

```bash
# Create two worktrees with identical specs
make worktree-create REPO=dormway-platform BRANCH=experiment/claude-automl
make worktree-create REPO=dormway-platform BRANCH=experiment/opus-automl

# Give both Claude Code sessions the same prompt
# Compare implementations, code quality, and approach
```

## üìã Workflow Best Practices

### Naming Conventions

Use clear, descriptive names:
- ‚úÖ `feat/auth-oauth2` - Feature: OAuth2 authentication
- ‚úÖ `bug/payment-timeout` - Bug: Payment timeout issue
- ‚úÖ `experiment/react-18` - Experiment: React 18 upgrade
- ‚ùå `test`, `temp`, `feature-1` - Too vague

### Daily Workflow

```bash
# Morning: List active worktrees
make worktree-list

# Start working on a feature
cd ../dormway-worktrees/dormway-platform-feat/my-feature
code .  # Claude Code remembers everything!

# End of day: Commit your work
git add -A
git commit -m "feat: implement feature X"
git push origin feat/my-feature

# After PR is merged: Clean up
make worktree-remove REPO=dormway-platform BRANCH=feat/my-feature
```

### Managing Multiple Worktrees

```bash
# See all worktrees and their status
make worktree-list

# Check which worktrees have uncommitted changes
cd ../dormway-worktrees/dormway-platform-feat/my-feature
git status

# Clean up merged worktrees regularly
make worktree-cleanup
```

## üîß Advanced Techniques

### Smart Default Branch Detection

The scripts automatically detect the default branch for each repository:
1. Checks `origin/HEAD` (Git's default branch reference)
2. Falls back to `main` if available
3. Falls back to `master` if available
4. Prompts for explicit specification if none found

This means you can use the same command across all repos, even if they use different default branch names!

### Shared Dependencies

For Node.js projects, you can share `node_modules` to save disk space:

```bash
# In worktree
cd ../dormway-worktrees/dormway-platform-feat/my-feature
ln -s ../../dormway-beta-workspace/.repos/dormway-platform/node_modules ./node_modules

# Or use pnpm (automatically shares packages)
pnpm install
```

**Note**: Be careful with shared dependencies - ensure package versions are compatible!

### Environment Variables

Each worktree can have its own environment:

```bash
# In worktree
cd ../dormway-worktrees/dormway-platform-feat/my-feature
echo "NODE_ENV=development" > .env.local
```

### VS Code Workspace Files

Create separate workspace files for each worktree:

```bash
cd ../dormway-worktrees/dormway-platform-feat/my-feature
code --new-window .  # Opens in new window
```

## üêõ Troubleshooting

### "Branch already checked out"

If you see this error, the branch is already checked out somewhere:

```bash
# List all worktrees to find the conflict
make worktree-list

# Remove the conflicting worktree
make worktree-remove REPO=dormway-platform BRANCH=feat/my-feature
```

### "Base branch not found"

If the base branch doesn't exist locally or remotely:

```bash
# The script will automatically try to fetch it
# If that fails, manually fetch and checkout:
cd .repos/dormway-platform
git fetch origin main
git checkout main
```

### "Worktree path already exists"

If the worktree directory already exists (but isn't registered):

```bash
# Remove the directory manually, then create the worktree again
rm -rf ../dormway-worktrees/dormway-platform-feat/my-feature
make worktree-create REPO=dormway-platform BRANCH=feat/my-feature
```

### Orphaned Worktrees

If a worktree directory was deleted manually:

```bash
# Clean up orphaned references
make worktree-cleanup
# Or
./scripts/worktree-cleanup.sh true true
```

### Disk Space

Worktrees share the `.git` directory, so they're relatively lightweight. To optimize:

```bash
# Clean up Git objects
cd .repos/dormway-platform
git repack -ad
```

## üìö Scripts Reference

All scripts are in `scripts/`:

- `worktree-create.sh <repo> <branch> [base]` - Create worktree for one repo
- `worktree-create-all.sh <branch> [base]` - Create worktrees for all repos
- `worktree-list.sh` - List all worktrees
- `worktree-remove.sh <repo> <branch>` - Remove a worktree
- `worktree-cleanup.sh [remove-merged] [remove-orphaned]` - Clean up worktrees

## üéì Learning More

- [Git Worktrees Documentation](https://git-scm.com/docs/git-worktree)
- Original inspiration: [Mastering Git Worktrees with Claude Code](https://medium.com/@dogukantuna/mastering-git-worktrees-with-claude-code-for-parallel-development-workflow)

## üí≠ Key Benefits

1. **No Context Switching**: Claude Code maintains full understanding in each worktree
2. **Parallel Development**: Work on multiple features simultaneously
3. **Safe Experimentation**: Test changes without affecting main branches
4. **Zero Risk**: Impossible to commit to the wrong branch
5. **Productivity Multiplier**: Multiple AI-powered development streams

---

**Remember**: Each worktree is a complete, isolated workspace. Claude Code builds context independently in each one, so you can work on multiple tasks in parallel without losing momentum!
