---
title: "FRESH_CHAT_INSTRUCTIONS"
description: "You are continuing work on DormWay's dashboard intelligence system. Phase 0-1 is complete, Phase 2-3 is partial."
---

# Instructions for Fresh Chat - Dashboard Intelligence Implementation

**Created**: 2025-12-08
**Purpose**: Guide for a fresh Claude Code session to continue dashboard intelligence work

---

## Starting Point

You are continuing work on DormWay's dashboard intelligence system. Phase 0-1 is complete, Phase 2-3 is partial.

### First Actions

1. **Read the documentation**:
   ```
   npm run obsidian:search -- "Dashboard Intelligence"
   ```

2. **Review current implementation status**:
   - Check `obsidian-vault/DormWay/Engineering/Dashboard Intelligence/IMPLEMENTATION_STATUS.md`
   - Or in codebase: `services/dormway-lockedin/docs/IMPLEMENTATION_STATUS.md`

3. **Verify the codebase state**:
   ```bash
   # Check what branch you're on
   git status

   # The PR #624 contains recent theme/landing work
   # Dashboard intelligence code is in main or may need merging
   ```

---

## Recommended Next Steps (Priority Order)

### 1. ~~Wire `useLayoutTracking` Hook~~ âœ… COMPLETE

**Status**: Already integrated (verified 2025-12-08)

The hook is built AND integrated:
- `src/hooks/useLayoutTracking.ts` - Hook implementation
- `src/app/dashboard/home-v2/page.tsx` - Integration
  - Lines 270-275: Hook initialization
  - Line 817: `initializeLayout()` called on mount
  - Line 894: `trackLayoutChange()` called in handler
  - Line 1078: `onLayoutChange` connected to ResponsiveGridLayout

### 2. Integrate `useInsightTracking` Hook (1 hour)

**Status**: Hook exists, needs widget integration

The hook exists (`src/hooks/useInsightTracking.ts`) with full feature set:
- `trackImpression()` - viewport-based impression tracking with IntersectionObserver
- `trackDismiss()` - dismissal tracking
- `trackAction()` - action taken tracking
- `trackFeedback()` - explicit feedback (helpful/not_helpful)
- `createImpressionRef()` - ref callback for automatic tracking
- Dwell time tracking (5s+ threshold)
- Debounced batching (2s default)

**Files to modify**:
- `src/components/widgets/ActionCTAWidget.tsx` - Add insight tracking
- Any widget displaying `InsightAttribution` component

**What to do**:
1. Import `useInsightTracking` in ActionCTAWidget
2. Use `createImpressionRef()` on insight elements
3. Call `trackAction()` when user clicks CTA
4. Call `trackDismiss()` when user dismisses insight

### 3. Enhance Syllabus Extraction (4 hours)

Current syllabus extraction has basic insights. Enhance to extract:
- `late_penalty_info` - String describing late policy
- `professor_style` - Object with teaching style insights
- `grading_breakdown` - Detailed breakdown beyond just weights

**Files**:
- `services/dormway-crews/crews/syllabus_processor/`
- `services/engine/src/activities/syllabus.activities.ts`

### 4. Add Analytics Views (3 hours)

The `mv_insight_effectiveness` view exists. Add:
- Widget move frequency view
- Time-of-day pattern view
- Day-of-week pattern view
- Nightly refresh job for materialized views

**File**: `infrastructure/database/migrations/` (new migration)

---

## Key Architecture Decisions

### Why useLayoutEffect for Theme?
The `app/page.tsx` uses `useLayoutEffect` (not `useEffect`) for theme initialization to prevent theme flash. This runs synchronously before paint.

### Insight Attribution Pattern
Every AI-generated insight should have:
- `insightSource`: Where data came from ('syllabus', 'canvas', 'calendar', 'pattern', 'campus')
- `insightConfidence`: How sure we are ('high', 'medium', 'low')
- `insightReason`: Human-readable explanation
- `contextFactors`: What was considered

### Layout Learning Philosophy
- Every widget interaction generates learning data
- Events batched client-side, debounced to server
- Context captured: day, hour, device, campus, tab
- Goal: Auto-suggest/apply layouts based on patterns

---

## Code Patterns to Follow

### CSS Animations
Use existing animations from `globals.css`:
- `widget-enter` - Stagger animation for grid
- `urgent-pulse` - For overdue items
- `check-success` - For completion states
- `insight-reveal` - For expanding insights

### Widget Surface Classes
All widgets should use:
- `.widget-surface` - Base glassmorphism
- `.widget-surface-accent` - Purple border for AI
- `.widget-surface-urgent` - Red border for overdue
- `.widget-inner-card` - Nested content cards

### API Endpoints
- `POST /api/v1/layouts/events` - Batch layout events (max 100)
- `GET /api/v1/insights/preferences` - User preferences
- `PUT /api/v1/insights/preferences` - Update preferences
- `POST /api/v1/insights/interaction` - Single interaction
- `POST /api/v1/insights/batch` - Multiple interactions (max 50)

---

## Documentation Maintenance

As you implement, keep these documents updated:

1. **IMPLEMENTATION_STATUS.md** - Update completion percentages
2. **IMPLEMENTATION_TICKETS.md** - Check off completed items
3. **Session notes** - Add to `obsidian-vault/DormWay/` with date

Example session note format:
```markdown
# 2025-12-XX - Dashboard Intelligence Work

## Summary
- Completed: [what you did]
- Started: [what's in progress]
- Blocked: [any blockers]

## Code Changes
- `file.tsx` - Description of change

## Next Session
- [what the next developer should do]
```

---

## Commands Reference

```bash
# Start development
make dev

# Check service health
make status

# View logs
make logs s=dormway-lockedin

# Search Obsidian
npm run obsidian:search -- "your query"

# Run TypeScript check
cd services/dormway-lockedin && npm run lint
```

---

## Questions to Ask User

Before starting, clarify:
1. Should I focus on frontend integration (hooks) or backend enhancements (syllabus)?
2. Is there a specific phase/ticket priority from Linear?
3. Any timeline constraints for this session?

---

## Tags
#fresh-start #dashboard-intelligence #implementation-guide
