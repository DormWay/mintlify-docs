---
title: "Semester Planning Rework Summary"
description: "These changes make the planner output ready for UI wiring while keeping the system resilient if the crew is re-enabled later."
---

# Semester Processing Rework Summary

- Tightened Portkey prompts for semester planner, cross-course, conflict detection, and workload analysis to emit concise JSON. Every course reference now carries `courseId` + `contextId`; arrays are capped to avoid bloated payloads.
- Updated `runSemesterPlanningCrew` to parse the crew response before caching. No more 2.6 MB double-escaped blobs—stored output is compact JSON matching the schema above.
- Normalized planner data (`normalized_term_course_data`) feeds into `writeSemesterSummary`. All entries under `summary.courses` now have correct `contextId/context_id`, so downstream components can correlate courses reliably.
- Switched the crew service to drop jumbo metadata (`raw`, `pydantic`, `tasks_output`, etc.) when `_compact_output` is set. Crew responses are now ~7 KB while retaining the important sections (`_meta`, `semester_strategy`, `success_framework`, `risk_management`).
- Added feature flag `ENABLE_PLANNING_CREW`. The Temporal workflow skips the crew unless this env var is set to `true`, so legacy Portkey prompts handled by `semester_summary` remain the source of truth.
- Cleared and rebuilt `/docs/semester_summary.json`; context IDs propagate end-to-end and the weekly grid reflects the normalized schedule.

These changes make the planner output ready for UI wiring while keeping the system resilient if the crew is re-enabled later.
