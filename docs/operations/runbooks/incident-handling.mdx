---
title: "Incident Handling"
description: "_Last updated: 2026-01-04_"
---

# Incident Handling Runbook

_Last updated: 2026-01-04_

This runbook documents the incident response process for DormWay platform incidents.

## Incident Severity Levels

| Severity | Definition | Response Time | Examples |
|----------|-----------|---------------|----------|
| **SEV-1** | Critical: Service completely unavailable | 15 minutes | Complete outage, data breach |
| **SEV-2** | High: Major feature degraded | 1 hour | Auth failures, dashboard down |
| **SEV-3** | Medium: Minor feature impacted | 4 hours | Slow performance, single endpoint down |
| **SEV-4** | Low: Minimal impact | 24 hours | UI bugs, non-critical errors |

---

## Incident Detection Sources

| Source | Monitors | Alert Channel |
|--------|---------|---------------|
| **Sentry** | Application errors, exceptions | Email, Slack #alerts |
| **Dash0** | Traces, metrics, latency | Dashboards |
| **Health Endpoints** | Service availability | Synthetic checks |
| **User Reports** | Bugs, issues | Slack #support, email |
| **Temporal** | Workflow failures | Temporal Cloud UI |

### Health Check Endpoints

| Service | Endpoint | Expected Response |
|---------|----------|-------------------|
| api-router | `https://api.dormway.com/health` | `{"status":"ok"}` |
| engine | Internal `:3030/health` | `{"status":"ok"}` |
| ably-relay | Internal `:3032/health` | `{"status":"ok"}` |

---

## Incident Response Process

### Phase 1: Detection & Triage (0-15 minutes)

#### 1.1 Acknowledge the Incident

```bash
# Post in #incidents Slack channel
/incident new [Brief description]

# Example:
/incident new API returning 500 errors on dashboard endpoint
```

#### 1.2 Assess Severity

Quick checks:
```bash
# Check service health
curl https://api.dormway.com/health

# Check Sentry for error spike
# https://sentry.io/organizations/dormway/issues/

# Check Temporal for workflow failures
# https://cloud.temporal.io/namespaces/dormway/workflows
```

**Severity Decision Tree:**
```
Is the app completely unusable?
├── Yes → SEV-1
└── No → Can users log in and see their dashboard?
    ├── No → SEV-2
    └── Yes → Is a specific feature broken?
        ├── Yes (core feature) → SEV-2
        ├── Yes (minor feature) → SEV-3
        └── No (just slow/buggy) → SEV-4
```

#### 1.3 Assign Incident Commander

For SEV-1/SEV-2:
- On-call engineer becomes Incident Commander
- IC coordinates response, delegates investigation
- IC owns all communications

### Phase 2: Investigation (15-60 minutes)

#### 2.1 Gather Information

```bash
# Check recent deployments
cd .repos/dormway-platform
git log --oneline -10

# Check service logs
make logs s=api-router | tail -100

# Check Sentry for stack traces
# https://sentry.io/organizations/dormway/issues/

# Check Dash0 for anomalies
# https://app.dash0.com/
```

#### 2.2 Identify Root Cause Categories

| Category | Indicators | First Actions |
|----------|------------|---------------|
| **Deployment** | Started after deploy | Rollback |
| **Database** | Connection errors, slow queries | Check Neon status |
| **External Service** | Third-party errors | Check service status pages |
| **Traffic** | Load spike | Scale or rate limit |
| **Security** | Unusual access patterns | Revoke credentials |

#### 2.3 Check External Dependencies

| Service | Status Page |
|---------|-------------|
| Neon | https://neonstatus.com |
| Clerk | https://status.clerk.com |
| Temporal Cloud | https://status.temporal.io |
| Ably | https://status.ably.com |
| Customer.io | https://status.customer.io |
| AWS | https://health.aws.amazon.com |

### Phase 3: Mitigation (Parallel with Investigation)

#### 3.1 Quick Mitigation Options

**Option A: Rollback Deployment**
```bash
# See: [Deployment Guide](/docs/engineering/technical/migration-deployment/deployment-guide)

# Quick rollback to previous image
aws ecs update-service \
  --cluster dormway-cluster \
  --service dormway-api-router-service \
  --task-definition dormway-api-router:PREVIOUS_VERSION \
  --force-new-deployment
```

**Option B: Restart Services**
```bash
# Force new deployment (restarts all tasks)
aws ecs update-service \
  --cluster dormway-cluster \
  --service dormway-api-router-service \
  --force-new-deployment
```

**Option C: Scale Up**
```bash
# Increase desired count
aws ecs update-service \
  --cluster dormway-cluster \
  --service dormway-api-router-service \
  --desired-count 4
```

**Option D: Feature Flag / Kill Switch**
```bash
# Disable problematic feature via Doppler config
doppler secrets set FEATURE_FLAG_X=false --project dormway --config prd
# Restart service to pick up change
```

#### 3.2 Database Issues

```bash
# Check Neon connection
cd .repos/dormway-platform
bash -c 'doppler run -- bash -c '\''psql "$DATABASE_URL_ADMIN" -c "SELECT 1"'\'''

# Check for long-running queries
bash -c 'doppler run -- bash -c '\''psql "$DATABASE_URL_ADMIN" -c "SELECT pid, now() - pg_stat_activity.query_start AS duration, query FROM pg_stat_activity WHERE state = '\''active'\'' ORDER BY duration DESC LIMIT 5"'\'''

# Kill runaway query if needed
bash -c 'doppler run -- bash -c '\''psql "$DATABASE_URL_ADMIN" -c "SELECT pg_cancel_backend([PID])"'\'''
```

#### 3.3 Temporal Workflow Issues

```bash
# Check for stuck workflows
# https://cloud.temporal.io/namespaces/dormway/workflows?status=Running

# Signal workflow to retry
# Use Temporal UI or tctl

# Cancel stuck workflow (last resort)
# Use Temporal UI to terminate
```

### Phase 4: Resolution & Recovery

#### 4.1 Verify Resolution

```bash
# Check health endpoint
curl https://api.dormway.com/health

# Check key user flows
# - Login at https://app.dormway.com
# - Dashboard loads
# - DayPlan visible

# Monitor error rates in Sentry
# Confirm error rate returning to baseline
```

#### 4.2 Communication

**During Incident (SEV-1/SEV-2):**
- Update #incidents channel every 15 minutes
- If user-facing: Update status page (if exists)

**Resolution Announcement:**
```
Incident Resolved: [Title]

Duration: [Start time] - [End time]
Impact: [Description of user impact]
Root Cause: [Brief description]
Resolution: [What fixed it]

Post-mortem to follow within 48 hours.
```

### Phase 5: Post-Incident (Within 48 hours)

#### 5.1 Post-Mortem Template

Create Linear ticket with:

```markdown
## Incident Summary
- **Date/Time**:
- **Duration**:
- **Severity**:
- **Impact**:

## Timeline
- HH:MM - Incident detected
- HH:MM - Triage began
- HH:MM - Root cause identified
- HH:MM - Mitigation applied
- HH:MM - Resolution confirmed

## Root Cause
[Detailed explanation]

## What Went Well
-
-

## What Could Be Improved
-
-

## Action Items
- [ ] [Action] - Owner - Due Date
- [ ] [Action] - Owner - Due Date

## Lessons Learned
-
```

#### 5.2 Action Item Follow-Up

- Create Linear tickets for all action items
- Schedule follow-up review in 1 week
- Update runbooks if needed

---

## Escalation Matrix

| Situation | Escalate To | Method |
|-----------|-------------|--------|
| SEV-1 (any time) | On-call + CTO | Phone + Slack |
| SEV-2 (business hours) | Engineering Lead | Slack |
| SEV-2 (after hours) | On-call | Slack + Phone |
| Security incident | CTO + all stakeholders | Immediate call |
| Data breach | CTO + Legal | Immediate call |

### Contact List

| Role | Name | Contact |
|------|------|---------|
| CTO | [Name] | [Phone/Slack] |
| Engineering Lead | [Name] | [Phone/Slack] |
| On-Call Primary | See schedule | [Phone/Slack] |
| On-Call Secondary | See schedule | [Phone/Slack] |

---

## Security Incidents

### Suspected Breach Response

1. **Contain** - Revoke compromised credentials immediately
2. **Assess** - Determine scope of access
3. **Notify** - Alert CTO and stakeholders
4. **Preserve** - Export audit logs before cleanup
5. **Remediate** - Follow [Secrets Rotation](/docs/operations/runbooks/secrets-rotation)
6. **Report** - Document for compliance

### Credential Compromise

```bash
# Immediately rotate affected credentials
# See: [Secrets Rotation](/docs/operations/runbooks/secrets-rotation#emergency-rotation-procedures)

# Check audit logs
# Doppler: https://dashboard.doppler.com/workplace/[workspace]/logs
# AWS: CloudTrail
# GitHub: Audit log
```

---

## Common Incident Playbooks

### API Returning 500 Errors

1. Check Sentry for error details
2. Check recent deployments
3. Check database connectivity
4. Check external service status
5. Rollback if deployment-related

### Authentication Failures

1. Check Clerk status
2. Verify Clerk credentials in Doppler
3. Check api-router logs for auth errors
4. Verify Zuplo gateway configuration

### Dashboard Not Loading

1. Check api-router health
2. Check BFF endpoints
3. Verify database queries
4. Check Ably for real-time issues

### DayPlan Not Generating

1. Check Temporal workflows
2. Verify StudentWatcher running
3. Check for workflow errors
4. Manual workflow signal if stuck

### Slow Performance

1. Check Dash0 for latency trends
2. Check database query times
3. Look for N+1 queries
4. Check Redis cache hit rate
5. Scale up if traffic-related

---

## Incident Documentation

All incidents should be logged in:
1. **Slack #incidents** - Real-time updates
2. **Linear** - Post-mortem and action items
3. **This runbook** - Add new playbooks for novel incidents

---

## Related Documents

- [Monitoring Triage](/docs/operations/runbooks/monitoring-triage)
- [Production Operations](/docs/operations/runbooks/production-operations)
- [Deployment Guide](/docs/engineering/technical/migration-deployment/deployment-guide)
- [Third-Party Tools & Services Inventory](/docs/engineering/architecture/third-party-tools-services-inventory)
